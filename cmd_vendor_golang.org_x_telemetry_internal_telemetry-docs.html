<!DOCTYPE html>
<html lang="en" data-theme="dark">
   <head>
      <meta charset="UTF-8" />
      <meta
         name="viewport"
         content="width=device-width, initial-scale=1.0"
      />
      <title>Docs - telemetry</title>
      <link
         href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"
         rel="stylesheet"
      />
      <style>
         html {
            font-size: 13px;
         }
         body {
            display: flex;
            min-height: 100vh;
            margin: 0;
         }
         .sidebar {
            width: 200px;
            background: rgba(59, 56, 56, 0.1);
            padding: 1.2rem;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
            margin-right: 7px;
         }
         main {
            flex: 0.9;
            padding: 1rem;
            margin: 0;
            max-width: calc(100% - 220px);
         }
         h1 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
         }
         h2 {
            font-size: 1.2rem;
            margin: 0.3rem 0 0.2rem;
         }
         pre {
            background: #1e1e1e;
            color: #dcdcdc;
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            margin: 0 0 1rem;
            font-size: 0.85rem;
            overflow-x: auto;
         }
         code {
            color: #f0dbdb;
            white-space: pre-wrap;
         }
         p {
            font-size: 15px;
            padding-top: 10px;
         }
         article {
            margin-bottom: 0.5rem;
            padding: 0.4rem 0.9rem;
            background: rgba(59, 56, 56, 0.5);
            border-radius: 10px;
            max-width: 99%;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);
         }
         .hidden {
            display: none;
         }
         .filter-toggle label {
            display: block;
            margin-bottom: 0.5rem;
         }
         .field-line {
            display: block;
         }
      </style>
   </head>
   <body>
      <aside class="sidebar">
         <a href="index.html">⌂</a>
         |
         <a href="#" onclick="history.back()">←</a>
         <hr style="opacity: 0" />
         <h2>Filters</h2>
         <hr />
         <input
            type="search"
            id="searchInput"
            placeholder="Search symbols..."
            style="
               width: 100%;
               margin-bottom: 1rem;
               margin-top: 0.8rem;
               border-radius: 10px !important;
               height: 50px;
               height: 2.5rem;
            "
         />
         <div class="filter-toggle">
            <label>
               <input type="checkbox" id="showPrivateFunctions" />
               Show private functions
            </label>
            <label>
               <input type="checkbox" id="showPrivateStructs" />
               Show private structs
            </label>
            <label>
               <input type="checkbox" id="showPrivateFields" />
               Show private struct fields
            </label>
            <label>
               <input type="checkbox" id="showPrivateGlobals" />
               Show private globals
            </label>
         </div>
         <hr style="opacity: 0" />
         <h2 style="padding-top: 5px">Subpackages</h2>
         <hr />
         
         <span style="color: rgba(177, 175, 175, 0.5)">
            No subpackages
         </span>
         
      </aside>
      <main>
         <h1>
            Package
            <code>telemetry</code>
         </h1>
         <hr />
         
         <article class="global" data-name="DateOnly">
            <h2>DateOnly</h2>
            <hr />
            
            <p>TODO(rfindley): replace uses of DateOnly with time.DateOnly once we no
longer support building gopls with go 1.19.</p>
            
            <pre><code>DateOnly</code></pre>
         </article>
         
         <article class="global" data-name="Default">
            <h2>Default</h2>
            <hr />
            
            <p>Default is the default directory containing Go telemetry configuration and
data.

If Default is uninitialized, Default.Mode will be "off". As a consequence,
no data should be written to the directory, and so the path values of
LocalDir, UploadDir, etc. must not matter.

Default is a global for convenience and testing, but should not be mutated
outside of tests.

TODO(rfindley): it would be nice to completely eliminate this global state,
or at least push it in the golang.org/x/telemetry package</p>
            
            <pre><code>Default Dir</code></pre>
         </article>
         
         <article class="global" data-name="DisabledOnPlatform">
            <h2>DisabledOnPlatform</h2>
            <hr />
            
            <p>DisabledOnPlatform indicates whether telemetry is disabled
due to bugs in the current platform.

TODO(rfindley): move to a more appropriate file.</p>
            
            <pre><code>DisabledOnPlatform</code></pre>
         </article>
          
         <article class="struct" data-name="UploadConfig">
            <h2>type UploadConfig struct</h2>
            <hr />
            
            <p>An UploadConfig controls what data is uploaded.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">GOOS []string
GOARCH []string
GoVersion []string
SampleRate float64
Programs []*ProgramConfig</code></pre>
         </article>
         
         <article class="struct" data-name="ProgramConfig">
            <h2>type ProgramConfig struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">Name string
Versions []string
Counters []CounterConfig
Stacks []CounterConfig</code></pre>
         </article>
         
         <article class="struct" data-name="CounterConfig">
            <h2>type CounterConfig struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">Name string
Rate float64
Depth int</code></pre>
         </article>
         
         <article class="struct" data-name="Report">
            <h2>type Report struct</h2>
            <hr />
            
            <p>A Report is the weekly aggregate of counters.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">Week string
LastWeek string
X float64
Programs []*ProgramReport
Config string</code></pre>
         </article>
         
         <article class="struct" data-name="ProgramReport">
            <h2>type ProgramReport struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">Program string
Version string
GoVersion string
GOOS string
GOARCH string
Counters *ast.MapType
Stacks *ast.MapType</code></pre>
         </article>
         
         <article class="struct" data-name="Dir">
            <h2>type Dir struct</h2>
            <hr />
            
            <p>A Dir holds paths to telemetry data inside a directory.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">dir string
local string
upload string
debug string
modefile string</code></pre>
         </article>
          
         <article class="function" data-name="NewDir">
            <h2>NewDir</h2>
            <hr />
            
            <p>NewDir creates a new Dir encapsulating paths in the given dir.

NewDir does not create any new directories or files--it merely encapsulates
the telemetry directory layout.</p>
            
            <pre><code>func NewDir(dir string) Dir</code></pre>
         </article>
         
         <article class="function" data-name="init">
            <h2>init</h2>
            <hr />
            
            <pre><code>func init()</code></pre>
         </article>
         
         <article class="function" data-name="Dir">
            <h2>Dir</h2>
            <hr />
            
            <pre><code>func Dir() string</code></pre>
         </article>
         
         <article class="function" data-name="LocalDir">
            <h2>LocalDir</h2>
            <hr />
            
            <pre><code>func LocalDir() string</code></pre>
         </article>
         
         <article class="function" data-name="UploadDir">
            <h2>UploadDir</h2>
            <hr />
            
            <pre><code>func UploadDir() string</code></pre>
         </article>
         
         <article class="function" data-name="DebugDir">
            <h2>DebugDir</h2>
            <hr />
            
            <pre><code>func DebugDir() string</code></pre>
         </article>
         
         <article class="function" data-name="ModeFile">
            <h2>ModeFile</h2>
            <hr />
            
            <pre><code>func ModeFile() string</code></pre>
         </article>
         
         <article class="function" data-name="SetMode">
            <h2>SetMode</h2>
            <hr />
            
            <p>SetMode updates the telemetry mode with the given mode.
Acceptable values for mode are "on", "off", or "local".

SetMode always writes the mode file, and explicitly records the date at
which the modefile was updated. This means that calling SetMode with "on"
effectively resets the timeout before the next telemetry report is uploaded.</p>
            
            <pre><code>func SetMode(mode string) error</code></pre>
         </article>
         
         <article class="function" data-name="SetModeAsOf">
            <h2>SetModeAsOf</h2>
            <hr />
            
            <p>SetModeAsOf is like SetMode, but accepts an explicit time to use to
back-date the mode state. This exists only for testing purposes.</p>
            
            <pre><code>func SetModeAsOf(mode string, asofTime time.Time) error</code></pre>
         </article>
         
         <article class="function" data-name="Mode">
            <h2>Mode</h2>
            <hr />
            
            <p>Mode returns the current telemetry mode, as well as the time that the mode
was effective.

If there is no effective time, the second result is the zero time.

If Mode is "off", no data should be written to the telemetry directory, and
the other paths values referenced by Dir should be considered undefined.
This accounts for the case where initializing [Default] fails, and therefore
local telemetry paths are unknown.</p>
            
            <pre><code>func Mode() (string, time.Time)</code></pre>
         </article>
         
         <article class="function" data-name="IsToolchainProgram">
            <h2>IsToolchainProgram</h2>
            <hr />
            
            <p>IsToolchainProgram reports whether a program with the given path is a Go
toolchain program.</p>
            
            <pre><code>func IsToolchainProgram(progPath string) bool</code></pre>
         </article>
         
         <article class="function" data-name="ProgramInfo">
            <h2>ProgramInfo</h2>
            <hr />
            
            <p>ProgramInfo extracts the go version, program package path, and program
version to use for counter files.

For programs in the Go toolchain, the program version will be the same as
the Go version, and will typically be of the form "go1.2.3", not a semantic
version of the form "v1.2.3". Go versions may also include spaces and
special characters.</p>
            
            <pre><code>func ProgramInfo(info *debug.BuildInfo) (goVers string, progPath string, progVers string)</code></pre>
         </article>
         
      </main>
      <script>
         function isPrivate(name) {
            return /^[a-z]/.test(name);
         }
         document.addEventListener("DOMContentLoaded", () => {
            const toggles = {
               functions: document.getElementById("showPrivateFunctions"),
               structs: document.getElementById("showPrivateStructs"),
               fields: document.getElementById("showPrivateFields"),
               globals: document.getElementById("showPrivateGlobals"),
            };
            const hideInitial = (selector, toggle) => {
               document.querySelectorAll(selector).forEach((el) => {
                  const name = el.dataset.name;
                  if (isPrivate(name)) {
                     el.classList.add("private", "hidden");
                  }
               });
               toggle.addEventListener("change", () => {
                  const show = toggle.checked;
                  document
                     .querySelectorAll(`${selector}.private`)
                     .forEach((el) => {
                        el.classList.toggle("hidden", !show);
                     });
               });
            };
            hideInitial("article.function", toggles.functions);
            hideInitial("article.struct", toggles.structs);
            hideInitial("article.global", toggles.globals);
            document
               .querySelectorAll("article.struct")
               .forEach((article) => {
                  const codeBlock =
                     article.querySelector("code.fields-code");
                  if (!codeBlock) return;
                  const lines = codeBlock.innerText.split("\n");
                  const newContent = lines
                     .map((line) => {
                        const trimmed = line.trim();
                        const nameMatch = trimmed.match(
                           /^([A-Za-z_][A-Za-z0-9_]*)/
                        );
                        if (!nameMatch)
                           return `<span class=\"field-line\">${line}</span>`;
                        const name = nameMatch[1];
                        const isPriv = isPrivate(name);
                        return `<span class=\"field-line${
                           isPriv ? " hidden private" : ""
                        }\" data-name=\"${name}\">${line}</span>`;
                     })
                     .join("");
                  codeBlock.innerHTML = newContent;
                  toggles.fields.addEventListener("change", () => {
                     const show = toggles.fields.checked;
                     article
                        .querySelectorAll(".field-line.private")
                        .forEach((el) =>
                           el.classList.toggle("hidden", !show)
                        );
                  });
               });
            const searchInput = document.getElementById("searchInput");
            searchInput.addEventListener("input", () => {
               const query = searchInput.value.trim().toLowerCase();
               document.querySelectorAll("article").forEach((el) => {
                  const name = el.dataset.name.toLowerCase();
                  if (query === "" || name.includes(query)) {
                     el.classList.remove("hidden");
                  } else {
                     el.classList.add("hidden");
                  }
               });
            });
         });
      </script>
   </body>
</html>
