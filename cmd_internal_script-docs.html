<!DOCTYPE html>
<html lang="en" data-theme="dark">
   <head>
      <meta charset="UTF-8" />
      <meta
         name="viewport"
         content="width=device-width, initial-scale=1.0"
      />
      <title>Docs - script</title>
      <link
         href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"
         rel="stylesheet"
      />
      <style>
         html {
            font-size: 13px;
         }
         body {
            display: flex;
            min-height: 100vh;
            margin: 0;
         }
         .sidebar {
            width: 200px;
            background: rgba(59, 56, 56, 0.1);
            padding: 1.2rem;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
            margin-right: 7px;
         }
         main {
            flex: 0.9;
            padding: 1rem;
            margin: 0;
            max-width: calc(100% - 220px);
         }
         h1 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
         }
         h2 {
            font-size: 1.2rem;
            margin: 0.3rem 0 0.2rem;
         }
         pre {
            background: #1e1e1e;
            color: #dcdcdc;
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            margin: 0 0 1rem;
            font-size: 0.85rem;
            overflow-x: auto;
         }
         code {
            color: #f0dbdb;
            white-space: pre-wrap;
         }
         p {
            font-size: 15px;
            padding-top: 10px;
         }
         article {
            margin-bottom: 0.5rem;
            padding: 0.4rem 0.9rem;
            background: rgba(59, 56, 56, 0.5);
            border-radius: 10px;
            max-width: 99%;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);
         }
         .hidden {
            display: none;
         }
         .filter-toggle label {
            display: block;
            margin-bottom: 0.5rem;
         }
         .field-line {
            display: block;
         }
      </style>
   </head>
   <body>
      <aside class="sidebar">
         <a href="index.html">⌂</a>
         |
         <a href="#" onclick="history.back()">←</a>
         <hr style="opacity: 0" />
         <h2>Filters</h2>
         <hr />
         <input
            type="search"
            id="searchInput"
            placeholder="Search symbols..."
            style="
               width: 100%;
               margin-bottom: 1rem;
               margin-top: 0.8rem;
               border-radius: 10px !important;
               height: 50px;
               height: 2.5rem;
            "
         />
         <div class="filter-toggle">
            <label>
               <input type="checkbox" id="showPrivateFunctions" />
               Show private functions
            </label>
            <label>
               <input type="checkbox" id="showPrivateStructs" />
               Show private structs
            </label>
            <label>
               <input type="checkbox" id="showPrivateFields" />
               Show private struct fields
            </label>
            <label>
               <input type="checkbox" id="showPrivateGlobals" />
               Show private globals
            </label>
         </div>
         <hr style="opacity: 0" />
         <h2 style="padding-top: 5px">Subpackages</h2>
         <hr />
          
         <a href="cmd_internal_script_scripttest-docs.html">scripttest</a>
         <br />
          
      </aside>
      <main>
         <h1>
            Package
            <code>script</code>
         </h1>
         <hr />
         
         <article class="global" data-name="success">
            <h2>success</h2>
            <hr />
            
            <pre><code>success expectedStatus</code></pre>
         </article>
         
         <article class="global" data-name="failure">
            <h2>failure</h2>
            <hr />
            
            <pre><code>failure expectedStatus</code></pre>
         </article>
         
         <article class="global" data-name="successOrFailure">
            <h2>successOrFailure</h2>
            <hr />
            
            <pre><code>successOrFailure expectedStatus</code></pre>
         </article>
         
         <article class="global" data-name="argSepChars">
            <h2>argSepChars</h2>
            <hr />
            
            <pre><code>argSepChars</code></pre>
         </article>
         
         <article class="global" data-name="ErrUnexpectedSuccess">
            <h2>ErrUnexpectedSuccess</h2>
            <hr />
            
            <p>ErrUnexpectedSuccess indicates that a script command that was expected to
fail (as indicated by a "!" prefix) instead completed successfully.</p>
            
            <pre><code>ErrUnexpectedSuccess</code></pre>
         </article>
         
         <article class="global" data-name="ErrUsage">
            <h2>ErrUsage</h2>
            <hr />
            
            <p>ErrUsage may be returned by a Command to indicate that it was called with
invalid arguments; its Usage method may be called to obtain details.</p>
            
            <pre><code>ErrUsage</code></pre>
         </article>
         
         <article class="global" data-name="matchUsage">
            <h2>matchUsage</h2>
            <hr />
            
            <pre><code>matchUsage</code></pre>
         </article>
          
         <article class="struct" data-name="funcCond">
            <h2>type funcCond struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">eval func
usage CondUsage</code></pre>
         </article>
         
         <article class="struct" data-name="prefixCond">
            <h2>type prefixCond struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">eval func
usage CondUsage</code></pre>
         </article>
         
         <article class="struct" data-name="boolCond">
            <h2>type boolCond struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">v bool
usage CondUsage</code></pre>
         </article>
         
         <article class="struct" data-name="onceCond">
            <h2>type onceCond struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">eval func
usage CondUsage</code></pre>
         </article>
         
         <article class="struct" data-name="cachedCond">
            <h2>type cachedCond struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">m sync.Map
eval func
usage CondUsage</code></pre>
         </article>
         
         <article class="struct" data-name="Engine">
            <h2>type Engine struct</h2>
            <hr />
            
            <p>An Engine stores the configuration for executing a set of scripts.

The same Engine may execute multiple scripts concurrently.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">Cmds *ast.MapType
Conds *ast.MapType
Quiet bool</code></pre>
         </article>
         
         <article class="struct" data-name="CmdUsage">
            <h2>type CmdUsage struct</h2>
            <hr />
            
            <p>A CmdUsage describes the usage of a Cmd, independent of its name
(which can change based on its registration).</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">Summary string
Args string
Detail []string
Async bool
RegexpArgs func</code></pre>
         </article>
         
         <article class="struct" data-name="CondUsage">
            <h2>type CondUsage struct</h2>
            <hr />
            
            <p>A CondUsage describes the usage of a Cond, independent of its name
(which can change based on its registration).</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">Summary string
Prefix bool</code></pre>
         </article>
         
         <article class="struct" data-name="command">
            <h2>type command struct</h2>
            <hr />
            
            <p>A command is a complete command parsed from a script.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">file string
line int
want expectedStatus
conds []condition
name string
rawArgs [][]argFragment
args []string
background bool</code></pre>
         </article>
         
         <article class="struct" data-name="argFragment">
            <h2>type argFragment struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">s string
quoted bool</code></pre>
         </article>
         
         <article class="struct" data-name="condition">
            <h2>type condition struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">want bool
tag string</code></pre>
         </article>
         
         <article class="struct" data-name="CommandError">
            <h2>type CommandError struct</h2>
            <hr />
            
            <p>A CommandError describes an error resulting from attempting to execute a
specific command.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">File string
Line int
Op string
Args []string
Err error</code></pre>
         </article>
         
         <article class="struct" data-name="UsageError">
            <h2>type UsageError struct</h2>
            <hr />
            
            <p>A UsageError reports the valid arguments for a command.

It may be returned in response to invalid arguments.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">Name string
Command Cmd</code></pre>
         </article>
         
         <article class="struct" data-name="State">
            <h2>type State struct</h2>
            <hr />
            
            <p>A State encapsulates the current state of a running script engine,
including the script environment and any running background commands.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">engine *Engine
ctx context.Context
cancel context.CancelFunc
file string
log bytes.Buffer
workdir string
pwd string
env []string
envMap *ast.MapType
stdout string
stderr string
background []backgroundCmd</code></pre>
         </article>
         
         <article class="struct" data-name="backgroundCmd">
            <h2>type backgroundCmd struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">*command
wait WaitFunc</code></pre>
         </article>
         
         <article class="struct" data-name="funcCmd">
            <h2>type funcCmd struct</h2>
            <hr />
            
            <p>A funcCmd implements Cmd using a function value.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">usage CmdUsage
run func</code></pre>
         </article>
         
         <article class="struct" data-name="stopError">
            <h2>type stopError struct</h2>
            <hr />
            
            <p>stopError is the sentinel error type returned by the Stop command.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">msg string</code></pre>
         </article>
         
         <article class="struct" data-name="waitError">
            <h2>type waitError struct</h2>
            <hr />
            
            <p>A waitError wraps one or more errors returned by background commands.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">errs []*CommandError</code></pre>
         </article>
          
         <article class="function" data-name="isETXTBSY">
            <h2>isETXTBSY</h2>
            <hr />
            
            <pre><code>func isETXTBSY(err error) bool</code></pre>
         </article>
         
         <article class="function" data-name="isETXTBSY">
            <h2>isETXTBSY</h2>
            <hr />
            
            <pre><code>func isETXTBSY(err error) bool</code></pre>
         </article>
         
         <article class="function" data-name="DefaultConds">
            <h2>DefaultConds</h2>
            <hr />
            
            <p>DefaultConds returns a set of broadly useful script conditions.

Run the 'help' command within a script engine to view a list of the available
conditions.</p>
            
            <pre><code>func DefaultConds() *ast.MapType</code></pre>
         </article>
         
         <article class="function" data-name="Condition">
            <h2>Condition</h2>
            <hr />
            
            <p>Condition returns a Cond with the given summary and evaluation function.</p>
            
            <pre><code>func Condition(summary string, eval func) Cond</code></pre>
         </article>
         
         <article class="function" data-name="Usage">
            <h2>Usage</h2>
            <hr />
            
            <pre><code>func Usage() *CondUsage</code></pre>
         </article>
         
         <article class="function" data-name="Eval">
            <h2>Eval</h2>
            <hr />
            
            <pre><code>func Eval(s *State, suffix string) (bool, error)</code></pre>
         </article>
         
         <article class="function" data-name="PrefixCondition">
            <h2>PrefixCondition</h2>
            <hr />
            
            <p>PrefixCondition returns a Cond with the given summary and evaluation function.</p>
            
            <pre><code>func PrefixCondition(summary string, eval func) Cond</code></pre>
         </article>
         
         <article class="function" data-name="Usage">
            <h2>Usage</h2>
            <hr />
            
            <pre><code>func Usage() *CondUsage</code></pre>
         </article>
         
         <article class="function" data-name="Eval">
            <h2>Eval</h2>
            <hr />
            
            <pre><code>func Eval(s *State, suffix string) (bool, error)</code></pre>
         </article>
         
         <article class="function" data-name="BoolCondition">
            <h2>BoolCondition</h2>
            <hr />
            
            <p>BoolCondition returns a Cond with the given truth value and summary.
The Cond rejects the use of condition suffixes.</p>
            
            <pre><code>func BoolCondition(summary string, v bool) Cond</code></pre>
         </article>
         
         <article class="function" data-name="Usage">
            <h2>Usage</h2>
            <hr />
            
            <pre><code>func Usage() *CondUsage</code></pre>
         </article>
         
         <article class="function" data-name="Eval">
            <h2>Eval</h2>
            <hr />
            
            <pre><code>func Eval(s *State, suffix string) (bool, error)</code></pre>
         </article>
         
         <article class="function" data-name="OnceCondition">
            <h2>OnceCondition</h2>
            <hr />
            
            <p>OnceCondition returns a Cond that calls eval the first time the condition is
evaluated. Future calls reuse the same result.

The eval function is not passed a *State because the condition is cached
across all execution states and must not vary by state.</p>
            
            <pre><code>func OnceCondition(summary string, eval func) Cond</code></pre>
         </article>
         
         <article class="function" data-name="Usage">
            <h2>Usage</h2>
            <hr />
            
            <pre><code>func Usage() *CondUsage</code></pre>
         </article>
         
         <article class="function" data-name="Eval">
            <h2>Eval</h2>
            <hr />
            
            <pre><code>func Eval(s *State, suffix string) (bool, error)</code></pre>
         </article>
         
         <article class="function" data-name="CachedCondition">
            <h2>CachedCondition</h2>
            <hr />
            
            <p>CachedCondition is like Condition but only calls eval the first time the
condition is evaluated for a given suffix.
Future calls with the same suffix reuse the earlier result.

The eval function is not passed a *State because the condition is cached
across all execution states and must not vary by state.</p>
            
            <pre><code>func CachedCondition(summary string, eval func) Cond</code></pre>
         </article>
         
         <article class="function" data-name="Usage">
            <h2>Usage</h2>
            <hr />
            
            <pre><code>func Usage() *CondUsage</code></pre>
         </article>
         
         <article class="function" data-name="Eval">
            <h2>Eval</h2>
            <hr />
            
            <pre><code>func Eval(_ *State, suffix string) (bool, error)</code></pre>
         </article>
         
         <article class="function" data-name="NewEngine">
            <h2>NewEngine</h2>
            <hr />
            
            <p>NewEngine returns an Engine configured with a basic set of commands and conditions.</p>
            
            <pre><code>func NewEngine() *Engine</code></pre>
         </article>
         
         <article class="function" data-name="Execute">
            <h2>Execute</h2>
            <hr />
            
            <p>Execute reads and executes script, writing the output to log.

Execute stops and returns an error at the first command that does not succeed.
The returned error's text begins with "file:line: ".

If the script runs to completion or ends by a 'stop' command,
Execute returns nil.

Execute does not stop background commands started by the script
before returning. To stop those, use [State.CloseAndWait] or the
[Wait] command.</p>
            
            <pre><code>func Execute(s *State, file string, script *bufio.Reader, log io.Writer) err error</code></pre>
         </article>
         
         <article class="function" data-name="parse">
            <h2>parse</h2>
            <hr />
            
            <p>parse parses a single line as a list of space-separated arguments.
subject to environment variable expansion (but not resplitting).
Single quotes around text disable splitting and expansion.
To embed a single quote, double it:

	'Don''t communicate by sharing memory.'</p>
            
            <pre><code>func parse(filename string, lineno int, line string) (cmd *command, err error)</code></pre>
         </article>
         
         <article class="function" data-name="expandArgs">
            <h2>expandArgs</h2>
            <hr />
            
            <p>expandArgs expands the shell variables in rawArgs and joins them to form the
final arguments to pass to a command.</p>
            
            <pre><code>func expandArgs(s *State, rawArgs [][]argFragment, regexpArgs []int) []string</code></pre>
         </article>
         
         <article class="function" data-name="quoteArgs">
            <h2>quoteArgs</h2>
            <hr />
            
            <p>quoteArgs returns a string that parse would parse as args when passed to a command.

TODO(bcmills): This function should have a fuzz test.</p>
            
            <pre><code>func quoteArgs(args []string) string</code></pre>
         </article>
         
         <article class="function" data-name="conditionsActive">
            <h2>conditionsActive</h2>
            <hr />
            
            <pre><code>func conditionsActive(s *State, conds []condition) (bool, error)</code></pre>
         </article>
         
         <article class="function" data-name="runCommand">
            <h2>runCommand</h2>
            <hr />
            
            <pre><code>func runCommand(s *State, cmd *command, impl Cmd) error</code></pre>
         </article>
         
         <article class="function" data-name="checkStatus">
            <h2>checkStatus</h2>
            <hr />
            
            <pre><code>func checkStatus(cmd *command, err error) error</code></pre>
         </article>
         
         <article class="function" data-name="ListCmds">
            <h2>ListCmds</h2>
            <hr />
            
            <p>ListCmds prints to w a list of the named commands,
annotating each with its arguments and a short usage summary.
If verbose is true, ListCmds prints full details for each command.

Each of the name arguments should be a command name.
If no names are passed as arguments, ListCmds lists all the
commands registered in e.</p>
            
            <pre><code>func ListCmds(w io.Writer, verbose bool, names ...string) error</code></pre>
         </article>
         
         <article class="function" data-name="wrapLine">
            <h2>wrapLine</h2>
            <hr />
            
            <pre><code>func wrapLine(w io.Writer, line string, cols int, indent string) error</code></pre>
         </article>
         
         <article class="function" data-name="ListConds">
            <h2>ListConds</h2>
            <hr />
            
            <p>ListConds prints to w a list of conditions, one per line,
annotating each with a description and whether the condition
is true in the state s (if s is non-nil).

Each of the tag arguments should be a condition string of
the form "name" or "name:suffix". If no tags are passed as
arguments, ListConds lists all conditions registered in
the engine e.</p>
            
            <pre><code>func ListConds(w io.Writer, s *State, tags ...string) error</code></pre>
         </article>
         
         <article class="function" data-name="cmdError">
            <h2>cmdError</h2>
            <hr />
            
            <pre><code>func cmdError(cmd *command, err error) *CommandError</code></pre>
         </article>
         
         <article class="function" data-name="Error">
            <h2>Error</h2>
            <hr />
            
            <pre><code>func Error() string</code></pre>
         </article>
         
         <article class="function" data-name="Unwrap">
            <h2>Unwrap</h2>
            <hr />
            
            <pre><code>func Unwrap() error</code></pre>
         </article>
         
         <article class="function" data-name="Error">
            <h2>Error</h2>
            <hr />
            
            <pre><code>func Error() string</code></pre>
         </article>
         
         <article class="function" data-name="NewState">
            <h2>NewState</h2>
            <hr />
            
            <p>NewState returns a new State permanently associated with ctx, with its
initial working directory in workdir and its initial environment set to
initialEnv (or os.Environ(), if initialEnv is nil).

The new State also contains pseudo-environment-variables for
${/} and ${:} (for the platform's path and list separators respectively),
but does not pass those to subprocesses.</p>
            
            <pre><code>func NewState(ctx context.Context, workdir string, initialEnv []string) (*State, error)</code></pre>
         </article>
         
         <article class="function" data-name="CloseAndWait">
            <h2>CloseAndWait</h2>
            <hr />
            
            <p>CloseAndWait cancels the State's Context and waits for any background commands to
finish. If any remaining background command ended in an unexpected state,
Close returns a non-nil error.</p>
            
            <pre><code>func CloseAndWait(log io.Writer) error</code></pre>
         </article>
         
         <article class="function" data-name="Chdir">
            <h2>Chdir</h2>
            <hr />
            
            <p>Chdir changes the State's working directory to the given path.</p>
            
            <pre><code>func Chdir(path string) error</code></pre>
         </article>
         
         <article class="function" data-name="Context">
            <h2>Context</h2>
            <hr />
            
            <p>Context returns the Context with which the State was created.</p>
            
            <pre><code>func Context() context.Context</code></pre>
         </article>
         
         <article class="function" data-name="Environ">
            <h2>Environ</h2>
            <hr />
            
            <p>Environ returns a copy of the current script environment,
in the form "key=value".</p>
            
            <pre><code>func Environ() []string</code></pre>
         </article>
         
         <article class="function" data-name="ExpandEnv">
            <h2>ExpandEnv</h2>
            <hr />
            
            <p>ExpandEnv replaces ${var} or $var in the string according to the values of
the environment variables in s. References to undefined variables are
replaced by the empty string.</p>
            
            <pre><code>func ExpandEnv(str string, inRegexp bool) string</code></pre>
         </article>
         
         <article class="function" data-name="ExtractFiles">
            <h2>ExtractFiles</h2>
            <hr />
            
            <p>ExtractFiles extracts the files in ar to the state's current directory,
expanding any environment variables within each name.

The files must reside within the working directory with which the State was
originally created.</p>
            
            <pre><code>func ExtractFiles(ar *txtar.Archive) error</code></pre>
         </article>
         
         <article class="function" data-name="Getwd">
            <h2>Getwd</h2>
            <hr />
            
            <p>Getwd returns the directory in which to run the next script command.</p>
            
            <pre><code>func Getwd() string</code></pre>
         </article>
         
         <article class="function" data-name="Logf">
            <h2>Logf</h2>
            <hr />
            
            <p>Logf writes output to the script's log without updating its stdout or stderr
buffers. (The output log functions as a kind of meta-stderr.)</p>
            
            <pre><code>func Logf(format string, args ...any)</code></pre>
         </article>
         
         <article class="function" data-name="flushLog">
            <h2>flushLog</h2>
            <hr />
            
            <p>flushLog writes the contents of the script's log to w and clears the log.</p>
            
            <pre><code>func flushLog(w io.Writer) error</code></pre>
         </article>
         
         <article class="function" data-name="LookupEnv">
            <h2>LookupEnv</h2>
            <hr />
            
            <p>LookupEnv retrieves the value of the environment variable in s named by the key.</p>
            
            <pre><code>func LookupEnv(key string) (string, bool)</code></pre>
         </article>
         
         <article class="function" data-name="Path">
            <h2>Path</h2>
            <hr />
            
            <p>Path returns the absolute path in the host operating system for a
script-based (generally slash-separated and relative) path.</p>
            
            <pre><code>func Path(path string) string</code></pre>
         </article>
         
         <article class="function" data-name="Setenv">
            <h2>Setenv</h2>
            <hr />
            
            <p>Setenv sets the value of the environment variable in s named by the key.</p>
            
            <pre><code>func Setenv(key string, value string) error</code></pre>
         </article>
         
         <article class="function" data-name="Stdout">
            <h2>Stdout</h2>
            <hr />
            
            <p>Stdout returns the stdout output of the last command run,
or the empty string if no command has been run.</p>
            
            <pre><code>func Stdout() string</code></pre>
         </article>
         
         <article class="function" data-name="Stderr">
            <h2>Stderr</h2>
            <hr />
            
            <p>Stderr returns the stderr output of the last command run,
or the empty string if no command has been run.</p>
            
            <pre><code>func Stderr() string</code></pre>
         </article>
         
         <article class="function" data-name="cleanEnv">
            <h2>cleanEnv</h2>
            <hr />
            
            <p>cleanEnv returns a copy of env with any duplicates removed in favor of
later values and any required system variables defined.

If env is nil, cleanEnv copies the environment from os.Environ().</p>
            
            <pre><code>func cleanEnv(env []string, pwd string) []string</code></pre>
         </article>
         
         <article class="function" data-name="DefaultCmds">
            <h2>DefaultCmds</h2>
            <hr />
            
            <p>DefaultCmds returns a set of broadly useful script commands.

Run the 'help' command within a script engine to view a list of the available
commands.</p>
            
            <pre><code>func DefaultCmds() *ast.MapType</code></pre>
         </article>
         
         <article class="function" data-name="Command">
            <h2>Command</h2>
            <hr />
            
            <p>Command returns a new Cmd with a Usage method that returns a copy of the
given CmdUsage and a Run method calls the given function.</p>
            
            <pre><code>func Command(usage CmdUsage, run func) Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Run">
            <h2>Run</h2>
            <hr />
            
            <pre><code>func Run(s *State, args ...string) (WaitFunc, error)</code></pre>
         </article>
         
         <article class="function" data-name="Usage">
            <h2>Usage</h2>
            <hr />
            
            <pre><code>func Usage() *CmdUsage</code></pre>
         </article>
         
         <article class="function" data-name="firstNonFlag">
            <h2>firstNonFlag</h2>
            <hr />
            
            <p>firstNonFlag returns a slice containing the index of the first argument in
rawArgs that is not a flag, or nil if all arguments are flags.</p>
            
            <pre><code>func firstNonFlag(rawArgs ...string) []int</code></pre>
         </article>
         
         <article class="function" data-name="Cat">
            <h2>Cat</h2>
            <hr />
            
            <p>Cat writes the concatenated contents of the named file(s) to the script's
stdout buffer.</p>
            
            <pre><code>func Cat() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Cd">
            <h2>Cd</h2>
            <hr />
            
            <p>Cd changes the current working directory.</p>
            
            <pre><code>func Cd() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Chmod">
            <h2>Chmod</h2>
            <hr />
            
            <p>Chmod changes the permissions of a file or a directory..</p>
            
            <pre><code>func Chmod() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Cmp">
            <h2>Cmp</h2>
            <hr />
            
            <p>Cmp compares the contents of two files, or the contents of either the
"stdout" or "stderr" buffer and a file, returning a non-nil error if the
contents differ.</p>
            
            <pre><code>func Cmp() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Cmpenv">
            <h2>Cmpenv</h2>
            <hr />
            
            <p>Cmpenv is like Compare, but also performs environment substitutions
on the contents of both arguments.</p>
            
            <pre><code>func Cmpenv() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="doCompare">
            <h2>doCompare</h2>
            <hr />
            
            <pre><code>func doCompare(s *State, env bool, args ...string) error</code></pre>
         </article>
         
         <article class="function" data-name="Cp">
            <h2>Cp</h2>
            <hr />
            
            <p>Cp copies one or more files to a new location.</p>
            
            <pre><code>func Cp() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Echo">
            <h2>Echo</h2>
            <hr />
            
            <p>Echo writes its arguments to stdout, followed by a newline.</p>
            
            <pre><code>func Echo() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Env">
            <h2>Env</h2>
            <hr />
            
            <p>Env sets or logs the values of environment variables.

With no arguments, Env reports all variables in the environment.
"key=value" arguments set variables, and arguments without "="
cause the corresponding value to be printed to the stdout buffer.</p>
            
            <pre><code>func Env() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Exec">
            <h2>Exec</h2>
            <hr />
            
            <p>Exec runs an arbitrary executable as a subprocess.

When the Script's context is canceled, Exec sends the interrupt signal, then
waits for up to the given delay for the subprocess to flush output before
terminating it with os.Kill.</p>
            
            <pre><code>func Exec(cancel func, waitDelay time.Duration) Cmd</code></pre>
         </article>
         
         <article class="function" data-name="startCommand">
            <h2>startCommand</h2>
            <hr />
            
            <pre><code>func startCommand(s *State, name string, path string, args []string, cancel func, waitDelay time.Duration) (WaitFunc, error)</code></pre>
         </article>
         
         <article class="function" data-name="lookPath">
            <h2>lookPath</h2>
            <hr />
            
            <p>lookPath is (roughly) like exec.LookPath, but it uses the script's current
PATH to find the executable.</p>
            
            <pre><code>func lookPath(s *State, command string) (string, error)</code></pre>
         </article>
         
         <article class="function" data-name="pathEnvName">
            <h2>pathEnvName</h2>
            <hr />
            
            <p>pathEnvName returns the platform-specific variable used by os/exec.LookPath
to look up executable names (either "PATH" or "path").

TODO(bcmills): Investigate whether we can instead use PATH uniformly and
rewrite it to $path when executing subprocesses.</p>
            
            <pre><code>func pathEnvName() string</code></pre>
         </article>
         
         <article class="function" data-name="Exists">
            <h2>Exists</h2>
            <hr />
            
            <p>Exists checks that the named file(s) exist.</p>
            
            <pre><code>func Exists() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Grep">
            <h2>Grep</h2>
            <hr />
            
            <p>Grep checks that file content matches a regexp.
Like stdout/stderr and unlike Unix grep, it accepts Go regexp syntax.

Grep does not modify the State's stdout or stderr buffers.
(Its output goes to the script log, not stdout.)</p>
            
            <pre><code>func Grep() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="match">
            <h2>match</h2>
            <hr />
            
            <p>match implements the Grep, Stdout, and Stderr commands.</p>
            
            <pre><code>func match(s *State, args []string, text string, name string) error</code></pre>
         </article>
         
         <article class="function" data-name="Help">
            <h2>Help</h2>
            <hr />
            
            <p>Help writes command documentation to the script log.</p>
            
            <pre><code>func Help() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Mkdir">
            <h2>Mkdir</h2>
            <hr />
            
            <p>Mkdir creates a directory and any needed parent directories.</p>
            
            <pre><code>func Mkdir() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Mv">
            <h2>Mv</h2>
            <hr />
            
            <p>Mv renames an existing file or directory to a new path.</p>
            
            <pre><code>func Mv() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Program">
            <h2>Program</h2>
            <hr />
            
            <p>Program returns a new command that runs the named program, found from the
host process's PATH (not looked up in the script's PATH).</p>
            
            <pre><code>func Program(name string, cancel func, waitDelay time.Duration) Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Replace">
            <h2>Replace</h2>
            <hr />
            
            <p>Replace replaces all occurrences of a string in a file with another string.</p>
            
            <pre><code>func Replace() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Rm">
            <h2>Rm</h2>
            <hr />
            
            <p>Rm removes a file or directory.

If a directory, Rm also recursively removes that directory's
contents.</p>
            
            <pre><code>func Rm() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="removeAll">
            <h2>removeAll</h2>
            <hr />
            
            <p>removeAll removes dir and all files and directories it contains.

Unlike os.RemoveAll, removeAll attempts to make the directories writable if
needed in order to remove their contents.</p>
            
            <pre><code>func removeAll(dir string) error</code></pre>
         </article>
         
         <article class="function" data-name="Sleep">
            <h2>Sleep</h2>
            <hr />
            
            <p>Sleep sleeps for the given Go duration or until the script's context is
canceled, whichever happens first.</p>
            
            <pre><code>func Sleep() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Stderr">
            <h2>Stderr</h2>
            <hr />
            
            <p>Stderr searches for a regular expression in the stderr buffer.</p>
            
            <pre><code>func Stderr() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Stdout">
            <h2>Stdout</h2>
            <hr />
            
            <p>Stdout searches for a regular expression in the stdout buffer.</p>
            
            <pre><code>func Stdout() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Stop">
            <h2>Stop</h2>
            <hr />
            
            <p>Stop returns a sentinel error that causes script execution to halt
and s.Execute to return with a nil error.</p>
            
            <pre><code>func Stop() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Error">
            <h2>Error</h2>
            <hr />
            
            <pre><code>func Error() string</code></pre>
         </article>
         
         <article class="function" data-name="Symlink">
            <h2>Symlink</h2>
            <hr />
            
            <p>Symlink creates a symbolic link.</p>
            
            <pre><code>func Symlink() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Wait">
            <h2>Wait</h2>
            <hr />
            
            <p>Wait waits for the completion of background commands.

When Wait returns, the stdout and stderr buffers contain the concatenation of
the background commands' respective outputs in the order in which those
commands were started.</p>
            
            <pre><code>func Wait() Cmd</code></pre>
         </article>
         
         <article class="function" data-name="Error">
            <h2>Error</h2>
            <hr />
            
            <pre><code>func Error() string</code></pre>
         </article>
         
         <article class="function" data-name="Unwrap">
            <h2>Unwrap</h2>
            <hr />
            
            <pre><code>func Unwrap() error</code></pre>
         </article>
         
      </main>
      <script>
         function isPrivate(name) {
            return /^[a-z]/.test(name);
         }
         document.addEventListener("DOMContentLoaded", () => {
            const toggles = {
               functions: document.getElementById("showPrivateFunctions"),
               structs: document.getElementById("showPrivateStructs"),
               fields: document.getElementById("showPrivateFields"),
               globals: document.getElementById("showPrivateGlobals"),
            };
            const hideInitial = (selector, toggle) => {
               document.querySelectorAll(selector).forEach((el) => {
                  const name = el.dataset.name;
                  if (isPrivate(name)) {
                     el.classList.add("private", "hidden");
                  }
               });
               toggle.addEventListener("change", () => {
                  const show = toggle.checked;
                  document
                     .querySelectorAll(`${selector}.private`)
                     .forEach((el) => {
                        el.classList.toggle("hidden", !show);
                     });
               });
            };
            hideInitial("article.function", toggles.functions);
            hideInitial("article.struct", toggles.structs);
            hideInitial("article.global", toggles.globals);
            document
               .querySelectorAll("article.struct")
               .forEach((article) => {
                  const codeBlock =
                     article.querySelector("code.fields-code");
                  if (!codeBlock) return;
                  const lines = codeBlock.innerText.split("\n");
                  const newContent = lines
                     .map((line) => {
                        const trimmed = line.trim();
                        const nameMatch = trimmed.match(
                           /^([A-Za-z_][A-Za-z0-9_]*)/
                        );
                        if (!nameMatch)
                           return `<span class=\"field-line\">${line}</span>`;
                        const name = nameMatch[1];
                        const isPriv = isPrivate(name);
                        return `<span class=\"field-line${
                           isPriv ? " hidden private" : ""
                        }\" data-name=\"${name}\">${line}</span>`;
                     })
                     .join("");
                  codeBlock.innerHTML = newContent;
                  toggles.fields.addEventListener("change", () => {
                     const show = toggles.fields.checked;
                     article
                        .querySelectorAll(".field-line.private")
                        .forEach((el) =>
                           el.classList.toggle("hidden", !show)
                        );
                  });
               });
            const searchInput = document.getElementById("searchInput");
            searchInput.addEventListener("input", () => {
               const query = searchInput.value.trim().toLowerCase();
               document.querySelectorAll("article").forEach((el) => {
                  const name = el.dataset.name.toLowerCase();
                  if (query === "" || name.includes(query)) {
                     el.classList.remove("hidden");
                  } else {
                     el.classList.add("hidden");
                  }
               });
            });
         });
      </script>
   </body>
</html>
