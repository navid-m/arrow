<!DOCTYPE html>
<html lang="en" data-theme="dark">
   <head>
      <meta charset="UTF-8" />
      <meta
         name="viewport"
         content="width=device-width, initial-scale=1.0"
      />
      <title>Docs - buildid</title>
      <link
         href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"
         rel="stylesheet"
      />
      <style>
         html {
            font-size: 13px;
         }
         body {
            display: flex;
            min-height: 100vh;
            margin: 0;
         }
         .sidebar {
            width: 200px;
            background: rgba(59, 56, 56, 0.1);
            padding: 1.2rem;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
            margin-right: 7px;
         }
         main {
            flex: 0.9;
            padding: 1rem;
            margin: 0;
            max-width: calc(100% - 220px);
         }
         h1 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
         }
         h2 {
            font-size: 1.2rem;
            margin: 0.3rem 0 0.2rem;
         }
         pre {
            background: #1e1e1e;
            color: #dcdcdc;
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            margin: 0 0 1rem;
            font-size: 0.85rem;
            overflow-x: auto;
         }
         code {
            color: #f0dbdb;
            white-space: pre-wrap;
         }
         p {
            font-size: 15px;
            padding-top: 10px;
         }
         article {
            margin-bottom: 0.5rem;
            padding: 0.4rem 0.9rem;
            background: rgba(59, 56, 56, 0.5);
            border-radius: 10px;
            max-width: 99%;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);
         }
         .hidden {
            display: none;
         }
         .filter-toggle label {
            display: block;
            margin-bottom: 0.5rem;
         }
         .field-line {
            display: block;
         }
      </style>
   </head>
   <body>
      <aside class="sidebar">
         <a href="index.html">⌂</a>
         |
         <a href="#" onclick="history.back()">←</a>
         <hr style="opacity: 0" />
         <h2>Filters</h2>
         <hr />
         <input
            type="search"
            id="searchInput"
            placeholder="Search symbols..."
            style="
               width: 100%;
               margin-bottom: 1rem;
               margin-top: 0.8rem;
               border-radius: 10px !important;
               height: 50px;
               height: 2.5rem;
            "
         />
         <div class="filter-toggle">
            <label>
               <input type="checkbox" id="showPrivateFunctions" />
               Show private functions
            </label>
            <label>
               <input type="checkbox" id="showPrivateStructs" />
               Show private structs
            </label>
            <label>
               <input type="checkbox" id="showPrivateFields" />
               Show private struct fields
            </label>
            <label>
               <input type="checkbox" id="showPrivateGlobals" />
               Show private globals
            </label>
         </div>
         <hr style="opacity: 0" />
         <h2 style="padding-top: 5px">Subpackages</h2>
         <hr />
         
         <span style="color: rgba(177, 175, 175, 0.5)">
            No subpackages
         </span>
         
      </aside>
      <main>
         <h1>
            Package
            <code>buildid</code>
         </h1>
         <hr />
         
         <article class="global" data-name="errBuildIDMalformed">
            <h2>errBuildIDMalformed</h2>
            <hr />
            
            <pre><code>errBuildIDMalformed</code></pre>
         </article>
         
         <article class="global" data-name="bangArch">
            <h2>bangArch</h2>
            <hr />
            
            <pre><code>bangArch</code></pre>
         </article>
         
         <article class="global" data-name="pkgdef">
            <h2>pkgdef</h2>
            <hr />
            
            <pre><code>pkgdef</code></pre>
         </article>
         
         <article class="global" data-name="goobject">
            <h2>goobject</h2>
            <hr />
            
            <pre><code>goobject</code></pre>
         </article>
         
         <article class="global" data-name="buildid">
            <h2>buildid</h2>
            <hr />
            
            <pre><code>buildid</code></pre>
         </article>
         
         <article class="global" data-name="goBuildPrefix">
            <h2>goBuildPrefix</h2>
            <hr />
            
            <pre><code>goBuildPrefix</code></pre>
         </article>
         
         <article class="global" data-name="goBuildEnd">
            <h2>goBuildEnd</h2>
            <hr />
            
            <pre><code>goBuildEnd</code></pre>
         </article>
         
         <article class="global" data-name="elfPrefix">
            <h2>elfPrefix</h2>
            <hr />
            
            <pre><code>elfPrefix</code></pre>
         </article>
         
         <article class="global" data-name="machoPrefixes">
            <h2>machoPrefixes</h2>
            <hr />
            
            <pre><code>machoPrefixes</code></pre>
         </article>
         
         <article class="global" data-name="readSize">
            <h2>readSize</h2>
            <hr />
            
            <pre><code>readSize</code></pre>
         </article>
         
         <article class="global" data-name="expectedID">
            <h2>expectedID</h2>
            <hr />
            
            <pre><code>expectedID</code></pre>
         </article>
         
         <article class="global" data-name="newID">
            <h2>newID</h2>
            <hr />
            
            <pre><code>newID</code></pre>
         </article>
         
         <article class="global" data-name="elfGoNote">
            <h2>elfGoNote</h2>
            <hr />
            
            <pre><code>elfGoNote</code></pre>
         </article>
         
         <article class="global" data-name="elfGNUNote">
            <h2>elfGNUNote</h2>
            <hr />
            
            <pre><code>elfGNUNote</code></pre>
         </article>
          
         <article class="struct" data-name="excludedReader">
            <h2>type excludedReader struct</h2>
            <hr />
            
            <p>excludedReader wraps an io.Reader. Reading from it returns the bytes from
the underlying reader, except that when the byte offset is within the
range between start and end, it returns zero bytes.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">r io.Reader
off int64
start int64
end int64</code></pre>
         </article>
          
         <article class="function" data-name="ReadFile">
            <h2>ReadFile</h2>
            <hr />
            
            <p>ReadFile reads the build ID from an archive or executable file.</p>
            
            <pre><code>func ReadFile(name string) (id string, err error)</code></pre>
         </article>
         
         <article class="function" data-name="readGccgoArchive">
            <h2>readGccgoArchive</h2>
            <hr />
            
            <p>readGccgoArchive tries to parse the archive as a standard Unix
archive file, and fetch the build ID from the _buildid.o entry.
The _buildid.o entry is written by (*Builder).gccgoBuildIDELFFile
in cmd/go/internal/work/exec.go.</p>
            
            <pre><code>func readGccgoArchive(name string, f *os.File) (string, error)</code></pre>
         </article>
         
         <article class="function" data-name="readGccgoBigArchive">
            <h2>readGccgoBigArchive</h2>
            <hr />
            
            <p>readGccgoBigArchive tries to parse the archive as an AIX big
archive file, and fetch the build ID from the _buildid.o entry.
The _buildid.o entry is written by (*Builder).gccgoBuildIDXCOFFFile
in cmd/go/internal/work/exec.go.</p>
            
            <pre><code>func readGccgoBigArchive(name string, f *os.File) (string, error)</code></pre>
         </article>
         
         <article class="function" data-name="readBinary">
            <h2>readBinary</h2>
            <hr />
            
            <p>readBinary reads the build ID from a binary.

ELF binaries store the build ID in a proper PT_NOTE section.

Other binary formats are not so flexible. For those, the linker
stores the build ID as non-instruction bytes at the very beginning
of the text segment, which should appear near the beginning
of the file. This is clumsy but fairly portable. Custom locations
can be added for other binary types as needed, like we did for ELF.</p>
            
            <pre><code>func readBinary(name string, f *os.File) (id string, err error)</code></pre>
         </article>
         
         <article class="function" data-name="readRaw">
            <h2>readRaw</h2>
            <hr />
            
            <p>readRaw finds the raw build ID stored in text segment data.</p>
            
            <pre><code>func readRaw(name string, data []byte) (id string, err error)</code></pre>
         </article>
         
         <article class="function" data-name="HashToString">
            <h2>HashToString</h2>
            <hr />
            
            <p>HashToString converts the hash h to a string to be recorded
in package archives and binaries as part of the build ID.
We use the first 120 bits of the hash (5 chunks of 24 bits each) and encode
it in base64, resulting in a 20-byte string. Because this is only used for
detecting the need to rebuild installed files (not for lookups
in the object file cache), 120 bits are sufficient to drive the
probability of a false "do not need to rebuild" decision to effectively zero.
We embed two different hashes in archives and four in binaries,
so cutting to 20 bytes is a significant savings when build IDs are displayed.
(20*4+3 = 83 bytes compared to 64*4+3 = 259 bytes for the
more straightforward option of printing the entire h in base64).</p>
            
            <pre><code>func HashToString(h []byte) string</code></pre>
         </article>
         
         <article class="function" data-name="TestReadFile">
            <h2>TestReadFile</h2>
            <hr />
            
            <pre><code>func TestReadFile(t *testing.T)</code></pre>
         </article>
         
         <article class="function" data-name="TestFindAndHash">
            <h2>TestFindAndHash</h2>
            <hr />
            
            <pre><code>func TestFindAndHash(t *testing.T)</code></pre>
         </article>
         
         <article class="function" data-name="TestExcludedReader">
            <h2>TestExcludedReader</h2>
            <hr />
            
            <pre><code>func TestExcludedReader(t *testing.T)</code></pre>
         </article>
         
         <article class="function" data-name="TestEmptyID">
            <h2>TestEmptyID</h2>
            <hr />
            
            <pre><code>func TestEmptyID(t *testing.T)</code></pre>
         </article>
         
         <article class="function" data-name="readAligned4">
            <h2>readAligned4</h2>
            <hr />
            
            <pre><code>func readAligned4(r io.Reader, sz int32) ([]byte, error)</code></pre>
         </article>
         
         <article class="function" data-name="ReadELFNote">
            <h2>ReadELFNote</h2>
            <hr />
            
            <pre><code>func ReadELFNote(filename string, name string, typ int32) ([]byte, error)</code></pre>
         </article>
         
         <article class="function" data-name="readELF">
            <h2>readELF</h2>
            <hr />
            
            <p>The Go build ID is stored in a note described by an ELF PT_NOTE prog
header. The caller has already opened filename, to get f, and read
at least 4 kB out, in data.</p>
            
            <pre><code>func readELF(name string, f *os.File, data []byte) (buildid string, err error)</code></pre>
         </article>
         
         <article class="function" data-name="readMacho">
            <h2>readMacho</h2>
            <hr />
            
            <p>The Go build ID is stored at the beginning of the Mach-O __text segment.
The caller has already opened filename, to get f, and read a few kB out, in data.
Sadly, that's not guaranteed to hold the note, because there is an arbitrary amount
of other junk placed in the file ahead of the main text.</p>
            
            <pre><code>func readMacho(name string, f *os.File, data []byte) (buildid string, err error)</code></pre>
         </article>
         
         <article class="function" data-name="FindAndHash">
            <h2>FindAndHash</h2>
            <hr />
            
            <p>FindAndHash reads all of r and returns the offsets of occurrences of id.
While reading, findAndHash also computes and returns
a hash of the content of r, but with occurrences of id replaced by zeros.
FindAndHash reads bufSize bytes from r at a time.
If bufSize == 0, FindAndHash uses a reasonable default.</p>
            
            <pre><code>func FindAndHash(r io.Reader, id string, bufSize int) (matches []int64, hash []byte, err error)</code></pre>
         </article>
         
         <article class="function" data-name="Rewrite">
            <h2>Rewrite</h2>
            <hr />
            
            <pre><code>func Rewrite(w io.WriterAt, pos []int64, id string) error</code></pre>
         </article>
         
         <article class="function" data-name="excludeMachoCodeSignature">
            <h2>excludeMachoCodeSignature</h2>
            <hr />
            
            <pre><code>func excludeMachoCodeSignature(r io.Reader) io.Reader</code></pre>
         </article>
         
         <article class="function" data-name="excludeHostBuildID">
            <h2>excludeHostBuildID</h2>
            <hr />
            
            <pre><code>func excludeHostBuildID(r io.Reader, r0 io.Reader) io.Reader</code></pre>
         </article>
         
         <article class="function" data-name="Read">
            <h2>Read</h2>
            <hr />
            
            <pre><code>func Read(p []byte) (int, error)</code></pre>
         </article>
         
         <article class="function" data-name="findMachoCodeSignature">
            <h2>findMachoCodeSignature</h2>
            <hr />
            
            <pre><code>func findMachoCodeSignature(r any) (*macho.File, codesign.CodeSigCmd, bool)</code></pre>
         </article>
         
         <article class="function" data-name="findHostBuildID">
            <h2>findHostBuildID</h2>
            <hr />
            
            <pre><code>func findHostBuildID(r io.Reader) (offset int64, size int64, ok bool)</code></pre>
         </article>
         
      </main>
      <script>
         function isPrivate(name) {
            return /^[a-z]/.test(name);
         }
         document.addEventListener("DOMContentLoaded", () => {
            const toggles = {
               functions: document.getElementById("showPrivateFunctions"),
               structs: document.getElementById("showPrivateStructs"),
               fields: document.getElementById("showPrivateFields"),
               globals: document.getElementById("showPrivateGlobals"),
            };
            const hideInitial = (selector, toggle) => {
               document.querySelectorAll(selector).forEach((el) => {
                  const name = el.dataset.name;
                  if (isPrivate(name)) {
                     el.classList.add("private", "hidden");
                  }
               });
               toggle.addEventListener("change", () => {
                  const show = toggle.checked;
                  document
                     .querySelectorAll(`${selector}.private`)
                     .forEach((el) => {
                        el.classList.toggle("hidden", !show);
                     });
               });
            };
            hideInitial("article.function", toggles.functions);
            hideInitial("article.struct", toggles.structs);
            hideInitial("article.global", toggles.globals);
            document
               .querySelectorAll("article.struct")
               .forEach((article) => {
                  const codeBlock =
                     article.querySelector("code.fields-code");
                  if (!codeBlock) return;
                  const lines = codeBlock.innerText.split("\n");
                  const newContent = lines
                     .map((line) => {
                        const trimmed = line.trim();
                        const nameMatch = trimmed.match(
                           /^([A-Za-z_][A-Za-z0-9_]*)/
                        );
                        if (!nameMatch)
                           return `<span class=\"field-line\">${line}</span>`;
                        const name = nameMatch[1];
                        const isPriv = isPrivate(name);
                        return `<span class=\"field-line${
                           isPriv ? " hidden private" : ""
                        }\" data-name=\"${name}\">${line}</span>`;
                     })
                     .join("");
                  codeBlock.innerHTML = newContent;
                  toggles.fields.addEventListener("change", () => {
                     const show = toggles.fields.checked;
                     article
                        .querySelectorAll(".field-line.private")
                        .forEach((el) =>
                           el.classList.toggle("hidden", !show)
                        );
                  });
               });
            const searchInput = document.getElementById("searchInput");
            searchInput.addEventListener("input", () => {
               const query = searchInput.value.trim().toLowerCase();
               document.querySelectorAll("article").forEach((el) => {
                  const name = el.dataset.name.toLowerCase();
                  if (query === "" || name.includes(query)) {
                     el.classList.remove("hidden");
                  } else {
                     el.classList.add("hidden");
                  }
               });
            });
         });
      </script>
   </body>
</html>
