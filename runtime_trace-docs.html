<!DOCTYPE html>
<html lang="en" data-theme="dark">
   <head>
      <meta charset="UTF-8" />
      <meta
         name="viewport"
         content="width=device-width, initial-scale=1.0"
      />
      <title>Docs - trace</title>
      <link
         href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"
         rel="stylesheet"
      />
      <style>
         html {
            font-size: 14px;
            scroll-behavior: smooth;
         }

         body {
            display: flex;
            min-height: 100vh;
            margin: 0;
            line-height: 1.6;
         }

         .sidebar {
            width: 12%;
            background: rgba(59, 56, 56, 0.15);
            padding: 1.5rem;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.4);
            overflow-y: auto;
            position: sticky;
            top: 0;
            height: 100vh;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
         }

         .sidebar::-webkit-scrollbar {
            width: 6px;
         }

         .sidebar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
         }

         .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
         }

         main {
            flex: 1;
            padding: 2rem;
            margin: 0;
            max-width: calc(100% - 280px);
            background: linear-gradient(
               135deg,
               rgba(59, 56, 56, 0.05) 0%,
               rgba(0, 0, 0, 0.1) 100%
            );
         }

         .nav-links {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
         }

         .nav-links a {
            color: #ddd;
            text-decoration: none;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s ease;
         }

         .nav-links a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
         }

         h1 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #fff 0%, #ddd 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
         }

         h2 {
            font-size: 1.4rem;
            margin: 1rem 0 0.5rem;
            color: #f0f0f0;
         }

         h3 {
            font-size: 1.2rem;
            margin: 0.8rem 0 0.3rem;
            color: #e0e0e0;
            position: relative;
         }

         .sidebar h2,
         .sidebar h3 {
            font-size: 1rem;
            margin: 0.5rem 0 0.3rem;
            color: #ccc;
         }

         /* Anchor link styling */
         .anchor {
            color: rgba(255, 255, 255, 0.3);
            text-decoration: none;
            font-weight: normal;
            margin-left: 0.5rem;
            opacity: 0;
            transition: opacity 0.2s ease;
            font-size: 0.8em;
         }

         h3:hover .anchor,
         .anchor:focus {
            opacity: 1;
         }

         .anchor:hover {
            color: rgba(255, 255, 255, 0.6);
         }

         /* Scroll target offset for fixed elements */
         .symbol-anchor {
            scroll-margin-top: 2rem;
         }

         pre {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e6e6e6;
            padding: 1rem 1.2rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.9rem;
            overflow-x: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
         }

         code {
            color: #f5f5f5;
            font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
            white-space: pre-wrap;
         }

         p {
            font-size: 15px;
            margin: 1rem 0;
            color: #ddd;
         }

         article {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(59, 56, 56, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
         }

         article:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
            transform: translateY(-2px);
         }

         article:target {
            border-color: rgba(100, 200, 255, 0.5);
            box-shadow: 0 0 0 2px rgba(100, 200, 255, 0.2);
         }

         .hidden {
            display: none !important;
         }

         .filter-section {
            margin-bottom: 1.5rem;
         }

         .filter-section h3 {
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #aaa;
         }

         .filter-toggle label {
            display: flex;
            align-items: center;
            margin-bottom: 0.6rem;
            font-size: 0.85rem;
            color: #bbb;
            cursor: pointer;
            padding: 0.3rem;
            border-radius: 4px;
            transition: background 0.2s ease;
         }

         .filter-toggle label:hover {
            background: rgba(255, 255, 255, 0.05);
         }

         .filter-toggle input {
            margin-right: 0.6rem;
         }

         .field-line,
         .method-line {
            display: block;
         }

         #searchInput {
            width: 100%;
            margin-bottom: 1.5rem;
            border-radius: 8px !important;
            height: 2.8rem;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 0 1rem;
         }

         #searchInput::placeholder {
            color: rgba(255, 255, 255, 0.5);
         }

         #searchInput:focus {
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
         }

         .section-divider {
            height: 1px;
            background: linear-gradient(
               90deg,
               transparent 0%,
               rgba(255, 255, 255, 0.3) 50%,
               transparent 100%
            );
            margin: 1.5rem 0;
         }

         .subpackage-list {
            list-style: none;
            padding: 0;
         }

         .subpackage-list li {
            margin-bottom: 0.4rem;
         }

         .subpackage-list a {
            display: block;
            padding: 0.5rem 0.8rem;
            color: #ccc;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 0.85rem;
         }

         .subpackage-list a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            transform: translateX(4px);
         }

         .empty-state {
            color: rgba(177, 175, 175, 0.6);
            font-style: italic;
            font-size: 0.8rem;
         }

         .badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            color: #ddd;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
            margin-left: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
         }

         .method-badge {
            background: rgba(100, 200, 255, 0.2);
            color: #87ceeb;
         }

         .const-badge {
            background: rgba(255, 200, 100, 0.2);
            color: #ffd700;
         }

         .var-badge {
            background: rgba(200, 255, 100, 0.2);
            color: #90ee90;
         }

         .type-badge {
            background: rgba(255, 100, 200, 0.2);
            color: #699eff;
         }

         .interface-badge {
            background: rgba(150, 100, 255, 0.2);
            color: #dda0dd;
         }

         .toc {
            position: sticky;
            top: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
         }

         .toc h4 {
            margin: 0 0 0.8rem;
            font-size: 0.9rem;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 0.5px;
         }

         .toc ul {
            list-style: none;
            padding: 0;
            margin: 0;
         }

         .toc li {
            margin-bottom: 0.3rem;
         }

         .toc a {
            color: #bbb;
            text-decoration: none;
            font-size: 0.8rem;
            transition: color 0.2s ease;
         }

         .toc a:hover {
            color: #fff;
         }

         .symbol-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.2);
         }

         .symbol-list::-webkit-scrollbar {
            width: 4px;
         }

         .symbol-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
         }

         .symbol-list ul {
            list-style: none;
            padding: 0.5rem;
            margin: 0;
         }

         .symbol-list li {
            margin-bottom: 0.2rem;
         }

         .symbol-list a {
            display: block;
            padding: 0.3rem 0.5rem;
            color: #bbb;
            text-decoration: none;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-size: 0.75rem;
         }

         .symbol-list a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
         }

         @media (max-width: 768px) {
            body {
               flex-direction: column;
            }

            .sidebar {
               width: 90%;
               height: auto;
               position: relative;
            }

            main {
               max-width: 100%;
               padding: 1rem;
            }
         }
      </style>
   </head>
   <body>
      <aside class="sidebar">
         <div class="nav-links">
            <a href="index.html" title="Home">⌂</a>
            <span>|</span>
            <a href="#" onclick="history.back()" title="Back">←</a>
         </div>

         <div class="filter-section">
            <h3>Search</h3>
            <input
               type="search"
               id="searchInput"
               placeholder="Search symbols..."
            />
         </div>

         <div class="filter-section">
            <h3>Filters</h3>
            <div class="filter-toggle">
               <label>
                  <input type="checkbox" id="showImports" />
                  Show imports
               </label>
               <label>
                  <input type="checkbox" id="showPrivateFunctions" />
                  Show private functions
               </label>
               <label>
                  <input type="checkbox" id="showPrivateStructs" />
                  Show private structs
               </label>
               <label>
                  <input type="checkbox" id="showPrivateFields" />
                  Show private fields
               </label>
               <label>
                  <input type="checkbox" id="showPrivateGlobals" />
                  Show private globals
               </label>
               <label>
                  <input type="checkbox" id="showPrivateTypes" />
                  Show private types
               </label>
               <label>
                  <input type="checkbox" id="showPrivateInterfaces" />
                  Show private interfaces
               </label>
            </div>
         </div>

         <div class="section-divider"></div>

         <div class="filter-section">
            <h3>Subpackages</h3>
            
            <div class="empty-state">No subpackages</div>
            
         </div>

         
         <div class="section-divider"></div>

         <div class="toc">
            <h4>Quick Navigation</h4>
            <ul>
               
               <li><a href="#globals">Constants & Variables</a></li>
                  
               <li><a href="#structs">Structs</a></li>
                
               <li><a href="#functions">Functions</a></li>
               
            </ul>
         </div>

         <div class="filter-section">
            <h3>All Symbols</h3>
            <div class="symbol-list">
               <ul id="symbolIndex">
               </ul>
            </div>
         </div>
         
      </aside>

      <main>
         <h1>trace</h1>
         <div class="section-divider"></div>

         
         <section id="imports">
            <h2>Imports</h2>
            <article class="imports symbol-anchor" id="imports-section" data-name="imports">
               <h3>
                  Imports
                  <a href="#imports-section" class="anchor" title="Link to imports">#</a>
               </h3>
               <pre><code>"context"
"fmt"
"sync/atomic"
_ "unsafe"
"io"
"runtime"
"sync"
"sync/atomic"
</code></pre>
            </article>
         </section>
          
         <section id="globals">
            <h2>Constants & Variables</h2>
            
            <article class="global symbol-anchor" id="bgTask" data-name="bgTask">
               <h3>
                  bgTask 
                  <span class="badge var-badge">var</span>
                  
                  <a href="#bgTask" class="anchor" title="Link to bgTask">#</a>
               </h3>
               
               <pre><code>var bgTask = Task{...}</code></pre>
            </article>
            
            <article class="global symbol-anchor" id="lastTaskID" data-name="lastTaskID">
               <h3>
                  lastTaskID 
                  <span class="badge var-badge">var</span>
                  
                  <a href="#lastTaskID" class="anchor" title="Link to lastTaskID">#</a>
               </h3>
               
               <pre><code>var lastTaskID uint64 = 0</code></pre>
            </article>
            
            <article class="global symbol-anchor" id="noopRegion" data-name="noopRegion">
               <h3>
                  noopRegion 
                  <span class="badge var-badge">var</span>
                  
                  <a href="#noopRegion" class="anchor" title="Link to noopRegion">#</a>
               </h3>
               
               <pre><code>var noopRegion = *ast.UnaryExpr</code></pre>
            </article>
            
            <article class="global symbol-anchor" id="regionEndCode" data-name="regionEndCode">
               <h3>
                  regionEndCode 
                  <span class="badge const-badge">const</span>
                  
                  <a href="#regionEndCode" class="anchor" title="Link to regionEndCode">#</a>
               </h3>
               
               <pre><code>const regionEndCode = *ast.CallExpr</code></pre>
            </article>
            
            <article class="global symbol-anchor" id="regionStartCode" data-name="regionStartCode">
               <h3>
                  regionStartCode 
                  <span class="badge const-badge">const</span>
                  
                  <a href="#regionStartCode" class="anchor" title="Link to regionStartCode">#</a>
               </h3>
               
               <pre><code>const regionStartCode = *ast.CallExpr</code></pre>
            </article>
            
            <article class="global symbol-anchor" id="tracing" data-name="tracing">
               <h3>
                  tracing 
                  <span class="badge var-badge">var</span>
                  
                  <a href="#tracing" class="anchor" title="Link to tracing">#</a>
               </h3>
               
               <pre><code>var tracing struct{...}</code></pre>
            </article>
            
         </section>
            
         <section id="structs">
            <h2>Structs</h2>
            
            <article class="struct symbol-anchor" id="Region" data-name="Region">
               <h3>
                  Region
                  <span class="badge">struct</span>
                  <a href="#Region" class="anchor" title="Link to Region">#</a>
               </h3>
               
               <p>Region is a region of code whose execution time interval is traced.</p>
               
               <pre
                  class="fields-block"
               ><code class="fields-code">type Region struct {
id uint64
regionType string
}</code></pre>
            </article>
            
            <article class="struct symbol-anchor" id="Task" data-name="Task">
               <h3>
                  Task
                  <span class="badge">struct</span>
                  <a href="#Task" class="anchor" title="Link to Task">#</a>
               </h3>
               
               <p>Task is a data type for tracing a user-defined, logical operation.</p>
               
               <pre
                  class="fields-block"
               ><code class="fields-code">type Task struct {
id uint64
}</code></pre>
            </article>
            
            <article class="struct symbol-anchor" id="traceContextKey" data-name="traceContextKey">
               <h3>
                  traceContextKey
                  <span class="badge">struct</span>
                  <a href="#traceContextKey" class="anchor" title="Link to traceContextKey">#</a>
               </h3>
               
               <pre
                  class="fields-block"
               ><code class="fields-code">type traceContextKey struct {

}</code></pre>
            </article>
            
         </section>
          
         <section id="functions">
            <h2>Functions</h2>
            
            <article class="function symbol-anchor" id="End" data-name="End">
               <h3>
                  End 
                  <span class="badge method-badge">method</span>
                  
                  <a href="#End" class="anchor" title="Link to End">#</a>
               </h3>
               
               <p>End marks the end of the traced code region.</p>
               
               <pre><code>func (r *Region) End()</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="End" data-name="End">
               <h3>
                  End 
                  <span class="badge method-badge">method</span>
                  
                  <a href="#End" class="anchor" title="Link to End">#</a>
               </h3>
               
               <p>End marks the end of the operation represented by the [Task].</p>
               
               <pre><code>func (t *Task) End()</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="IsEnabled" data-name="IsEnabled">
               <h3>
                  IsEnabled 
                  <span class="badge">function</span>
                  
                  <a href="#IsEnabled" class="anchor" title="Link to IsEnabled">#</a>
               </h3>
               
               <p>IsEnabled reports whether tracing is enabled.
The information is advisory only. The tracing status
may have changed by the time this function returns.</p>
               
               <pre><code>func IsEnabled() bool</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="Log" data-name="Log">
               <h3>
                  Log 
                  <span class="badge">function</span>
                  
                  <a href="#Log" class="anchor" title="Link to Log">#</a>
               </h3>
               
               <p>Log emits a one-off event with the given category and message.
Category can be empty and the API assumes there are only a handful of
unique categories in the system.</p>
               
               <pre><code>func Log(ctx context.Context, category string, message string)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="Logf" data-name="Logf">
               <h3>
                  Logf 
                  <span class="badge">function</span>
                  
                  <a href="#Logf" class="anchor" title="Link to Logf">#</a>
               </h3>
               
               <p>Logf is like [Log], but the value is formatted using the specified format spec.</p>
               
               <pre><code>func Logf(ctx context.Context, category string, format string, args ...any)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="NewTask" data-name="NewTask">
               <h3>
                  NewTask 
                  <span class="badge">function</span>
                  
                  <a href="#NewTask" class="anchor" title="Link to NewTask">#</a>
               </h3>
               
               <p>NewTask creates a task instance with the type taskType and returns
it along with a Context that carries the task.
If the input context contains a task, the new task is its subtask.
The taskType is used to classify task instances. Analysis tools
like the Go execution tracer may assume there are only a bounded
number of unique task types in the system.
The returned Task's [Task.End] method is used to mark the task's end.
The trace tool measures task latency as the time between task creation
and when the End method is called, and provides the latency
distribution per task type.
If the End method is called multiple times, only the first
call is used in the latency measurement.
ctx, task := trace.NewTask(ctx, "awesomeTask")
trace.WithRegion(ctx, "preparation", prepWork)
// preparation of the task
go func() {  // continue processing the task in a separate goroutine.
defer task.End()
trace.WithRegion(ctx, "remainingWork", remainingWork)
}()</p>
               
               <pre><code>func NewTask(pctx context.Context, taskType string) (ctx context.Context, task *Task)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="Start" data-name="Start">
               <h3>
                  Start 
                  <span class="badge">function</span>
                  
                  <a href="#Start" class="anchor" title="Link to Start">#</a>
               </h3>
               
               <p>Start enables tracing for the current program.
While tracing, the trace will be buffered and written to w.
Start returns an error if tracing is already enabled.</p>
               
               <pre><code>func Start(w io.Writer) error</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="StartRegion" data-name="StartRegion">
               <h3>
                  StartRegion 
                  <span class="badge">function</span>
                  
                  <a href="#StartRegion" class="anchor" title="Link to StartRegion">#</a>
               </h3>
               
               <p>StartRegion starts a region and returns it.
The returned Region's [Region.End] method must be called
from the same goroutine where the region was started.
Within each goroutine, regions must nest. That is, regions started
after this region must be ended before this region can be ended.
Recommended usage is
defer trace.StartRegion(ctx, "myTracedRegion").End()</p>
               
               <pre><code>func StartRegion(ctx context.Context, regionType string) *Region</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="Stop" data-name="Stop">
               <h3>
                  Stop 
                  <span class="badge">function</span>
                  
                  <a href="#Stop" class="anchor" title="Link to Stop">#</a>
               </h3>
               
               <p>Stop stops the current tracing, if any.
Stop only returns after all the writes for the trace have completed.</p>
               
               <pre><code>func Stop()</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="WithRegion" data-name="WithRegion">
               <h3>
                  WithRegion 
                  <span class="badge">function</span>
                  
                  <a href="#WithRegion" class="anchor" title="Link to WithRegion">#</a>
               </h3>
               
               <p>WithRegion starts a region associated with its calling goroutine, runs fn,
and then ends the region. If the context carries a task, the region is
associated with the task. Otherwise, the region is attached to the background
task.
The regionType is used to classify regions, so there should be only a
handful of unique region types.</p>
               
               <pre><code>func WithRegion(ctx context.Context, regionType string, fn func())</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="fromContext" data-name="fromContext">
               <h3>
                  fromContext 
                  <span class="badge">function</span>
                  
                  <a href="#fromContext" class="anchor" title="Link to fromContext">#</a>
               </h3>
               
               <pre><code>func fromContext(ctx context.Context) *Task</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="newID" data-name="newID">
               <h3>
                  newID 
                  <span class="badge">function</span>
                  
                  <a href="#newID" class="anchor" title="Link to newID">#</a>
               </h3>
               
               <pre><code>func newID() uint64</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="userLog" data-name="userLog">
               <h3>
                  userLog 
                  <span class="badge">function</span>
                  
                  <a href="#userLog" class="anchor" title="Link to userLog">#</a>
               </h3>
               
               <p>emits UserLog event.</p>
               
               <pre><code>func userLog(id uint64, category string, message string)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="userRegion" data-name="userRegion">
               <h3>
                  userRegion 
                  <span class="badge">function</span>
                  
                  <a href="#userRegion" class="anchor" title="Link to userRegion">#</a>
               </h3>
               
               <p>emits UserRegion event.</p>
               
               <pre><code>func userRegion(id uint64, mode uint64, regionType string)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="userTaskCreate" data-name="userTaskCreate">
               <h3>
                  userTaskCreate 
                  <span class="badge">function</span>
                  
                  <a href="#userTaskCreate" class="anchor" title="Link to userTaskCreate">#</a>
               </h3>
               
               <p>emits UserTaskCreate event.</p>
               
               <pre><code>func userTaskCreate(id uint64, parentID uint64, taskType string)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="userTaskEnd" data-name="userTaskEnd">
               <h3>
                  userTaskEnd 
                  <span class="badge">function</span>
                  
                  <a href="#userTaskEnd" class="anchor" title="Link to userTaskEnd">#</a>
               </h3>
               
               <p>emits UserTaskEnd event.</p>
               
               <pre><code>func userTaskEnd(id uint64)</code></pre>
            </article>
            
         </section>
         
      </main>

      <script>
         function isPrivate(name) {
            return /^[a-z]/.test(name);
         }

         function buildSymbolIndex() {
            const symbolIndex = document.getElementById('symbolIndex');
            if (!symbolIndex) return;

            const symbols = [];
            
            document.querySelectorAll('article[data-name]').forEach(article => {
               const name = article.dataset.name;
               const type = article.className.split(' ')[0]; 
               const isPrivateSymbol = isPrivate(name);
               
               if (name && name !== 'imports') {
                  symbols.push({
                     name,
                     type,
                     element: article,
                     isPrivate: isPrivateSymbol
                  });
               }
            });

            symbols.sort((a, b) => a.name.localeCompare(b.name));
            symbolIndex.innerHTML = '';
            symbols.forEach(symbol => {
               const li = document.createElement('li');
               const a = document.createElement('a');
               a.href = `#${symbol.name}`;
               a.textContent = symbol.name;
               a.title = `${symbol.type}: ${symbol.name}`;
               
               if (symbol.isPrivate) {
                  li.classList.add('private', 'hidden');
               }
               
               li.appendChild(a);
               symbolIndex.appendChild(li);
            });
         }

         document.addEventListener("DOMContentLoaded", () => {
            const toggles = {
               functions: document.getElementById("showPrivateFunctions"),
               imports: document.getElementById("showImports"),
               structs: document.getElementById("showPrivateStructs"),
               fields: document.getElementById("showPrivateFields"),
               globals: document.getElementById("showPrivateGlobals"),
               types: document.getElementById("showPrivateTypes"),
               interfaces: document.getElementById(
                  "showPrivateInterfaces"
               ),
            };

            const hideInitial = (selector, toggle) => {
               document.querySelectorAll(selector).forEach((el) => {
                  const name = el.dataset.name;
                  if (isPrivate(name)) {
                     el.classList.add("private", "hidden");
                  }
               });

               if (toggle) {
                  toggle.addEventListener("change", () => {
                     const show = toggle.checked;
                     document
                        .querySelectorAll(`${selector}.private`)
                        .forEach((el) => {
                           el.classList.toggle("hidden", !show);
                        });
                     
                     const symbolIndexItems = document.querySelectorAll('#symbolIndex li.private');
                     symbolIndexItems.forEach(li => {
                        const link = li.querySelector('a');
                        if (link) {
                           const targetId = link.getAttribute('href').substring(1);
                           const targetEl = document.getElementById(targetId);
                           if (targetEl && targetEl.matches(selector)) {
                              li.classList.toggle("hidden", !show);
                           }
                        }
                     });
                  });
               }
            };

            hideInitial("article.imports", toggles.imports);
            hideInitial("article.function", toggles.functions);
            hideInitial("article.struct", toggles.structs);
            hideInitial("article.global", toggles.globals);
            hideInitial("article.type", toggles.types);
            hideInitial("article.interface", toggles.interfaces);

            document
               .querySelectorAll("article.struct")
               .forEach((article) => {
                  const codeBlock =
                     article.querySelector("code.fields-code");
                  if (!codeBlock) return;

                  const lines = codeBlock.innerHTML.split("\n");
                  const newContent = lines
                     .map((line) => {
                        const trimmed = line.trim();
                        const nameMatch = trimmed.match(
                           /^([A-Za-z_][A-Za-z0-9_]*)/
                        );
                        if (!nameMatch && trimmed != "}") {
                           return `<span class="field-line">${line}</span>`;
                        }
                        if (nameMatch == null) return;
                        const name = nameMatch[1];
                        const isPriv = isPrivate(name);
                        return `<span class="field-line${
                           isPriv ? " hidden private" : ""
                        }" data-name="${name}">${line}</span>`;
                     })
                     .join("");

                  codeBlock.innerHTML = newContent;

                  if (toggles.fields) {
                     toggles.fields.addEventListener("change", () => {
                        const show = toggles.fields.checked;
                        article
                           .querySelectorAll(".field-line.private")
                           .forEach((el) =>
                              el.classList.toggle("hidden", !show)
                           );
                     });
                  }
               });

            document
               .querySelectorAll("article.interface")
               .forEach((article) => {
                  const codeBlock = article.querySelector(
                     "code.methods-code"
                  );
                  if (!codeBlock) return;

                  const lines = codeBlock.innerHTML.split("\n");
                  const newContent = lines
                     .map((line) => {
                        const trimmed = line.trim();
                        const nameMatch = trimmed.match(
                           /^([A-Za-z_][A-Za-z0-9_]*)/
                        );
                        if (!nameMatch) {
                           return `<span class="method-line">${line}</span>`;
                        }

                        const name = nameMatch[1];
                        const isPriv = isPrivate(name);
                        return `<span class="method-line${
                           isPriv ? " hidden private" : ""
                        }" data-name="${name}">${line}</span>`;
                     })
                     .join("");

                  codeBlock.innerHTML = newContent;

                  if (toggles.fields) {
                     toggles.fields.addEventListener("change", () => {
                        const show = toggles.fields.checked;
                        article
                           .querySelectorAll(".method-line.private")
                           .forEach((el) =>
                              el.classList.toggle("hidden", !show)
                           );
                     });
                  }
               });

            const searchInput = document.getElementById("searchInput");
            if (searchInput) {
               searchInput.addEventListener("input", () => {
                  const query = searchInput.value.trim().toLowerCase();

                  document.querySelectorAll("article").forEach((el) => {
                     const name = el.dataset.name;
                     if (!name) return;

                     const matches =
                        query === "" ||
                        name.toLowerCase().includes(query) ||
                        (el.textContent &&
                           el.textContent.toLowerCase().includes(query));

                     if (matches) {
                        const isPrivateEl =
                           el.classList.contains("private");
                        const shouldShowPrivate =
                           getPrivateToggleState(el);

                        if (!isPrivateEl || shouldShowPrivate) {
                           el.classList.remove("hidden");
                        }
                     } else {
                        el.classList.add("hidden");
                     }
                  });

                  document.querySelectorAll('#symbolIndex li').forEach(li => {
                     const link = li.querySelector('a');
                     if (link) {
                        const symbolName = link.textContent.toLowerCase();
                        const matches = query === "" || symbolName.includes(query);
                        
                        if (matches) {
                           const isPrivateSymbol = li.classList.contains('private');
                           const targetId = link.getAttribute('href').substring(1);
                           const targetEl = document.getElementById(targetId);
                           const shouldShowPrivate = targetEl ? getPrivateToggleState(targetEl) : false;
                           
                           if (!isPrivateSymbol || shouldShowPrivate) {
                              li.style.display = '';
                           }
                        } else {
                           li.style.display = 'none';
                        }
                     }
                  });
               });
            }

            function getPrivateToggleState(element) {
               if (element.classList.contains("function")) {
                  return toggles.functions?.checked || false;
               } else if (element.classList.contains("struct")) {
                  return toggles.structs?.checked || false;
               } else if (element.classList.contains("global")) {
                  return toggles.globals?.checked || false;
               } else if (element.classList.contains("type")) {
                  return toggles.types?.checked || false;
               } else if (element.classList.contains("interface")) {
                  return toggles.interfaces?.checked || false;
               } else if (element.classList.contains("imports")) {
                  return toggles.imports?.checked || false;
               }
               return false;
            }

            buildSymbolIndex();

            document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
               anchor.addEventListener("click", function (e) {
                  const target = document.querySelector(
                     this.getAttribute("href")
                  );
                  if (target) {
                     target.scrollIntoView({
                        behavior: "smooth",
                        block: "start",
                     });
                  }
               });
            });

            window.addEventListener('hashchange', () => {
               const hash = window.location.hash;
               if (hash) {
                  const target = document.querySelector(hash);
                  if (target) {
                     target.scrollIntoView({
                        behavior: "smooth",
                        block: "start",
                     });
                  }
               }
            });

            if (window.location.hash) {
               setTimeout(() => {
                  const target = document.querySelector(window.location.hash);
                  if (target) {
                     target.scrollIntoView({
                        behavior: "smooth",
                        block: "start",
                     });
                  }
               }, 100);
            }
         });
      </script>
   </body>
</html>