<!DOCTYPE html>
<html lang="en" data-theme="dark">
   <head>
      <meta charset="UTF-8" />
      <meta
         name="viewport"
         content="width=device-width, initial-scale=1.0"
      />
      <title>Docs - logopt</title>
      <link
         href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"
         rel="stylesheet"
      />
      <style>
         html {
            font-size: 14px;
            scroll-behavior: smooth;
         }

         body {
            display: flex;
            min-height: 100vh;
            margin: 0;
            line-height: 1.6;
         }

         .sidebar {
            width: 12%;
            background: rgba(59, 56, 56, 0.15);
            padding: 1.5rem;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.4);
            overflow-y: auto;
            position: sticky;
            top: 0;
            height: 100vh;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
         }

         .sidebar::-webkit-scrollbar {
            width: 6px;
         }

         .sidebar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
         }

         .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
         }

         main {
            flex: 1;
            padding: 2rem;
            margin: 0;
            max-width: calc(100% - 280px);
            background: linear-gradient(
               135deg,
               rgba(59, 56, 56, 0.05) 0%,
               rgba(0, 0, 0, 0.1) 100%
            );
         }

         .nav-links {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
         }

         .nav-links a {
            color: #ddd;
            text-decoration: none;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s ease;
         }

         .nav-links a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
         }

         h1 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #fff 0%, #ddd 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
         }

         h2 {
            font-size: 1.4rem;
            margin: 1rem 0 0.5rem;
            color: #f0f0f0;
         }

         h3 {
            font-size: 1.2rem;
            margin: 0.8rem 0 0.3rem;
            color: #e0e0e0;
         }

         .sidebar h2,
         .sidebar h3 {
            font-size: 1rem;
            margin: 0.5rem 0 0.3rem;
            color: #ccc;
         }

         pre {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e6e6e6;
            padding: 1rem 1.2rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.9rem;
            overflow-x: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
         }

         code {
            color: #f5f5f5;
            font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
            white-space: pre-wrap;
         }

         p {
            font-size: 15px;
            margin: 1rem 0;
            color: #ddd;
         }

         article {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(59, 56, 56, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
         }

         article:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
            transform: translateY(-2px);
         }

         .hidden {
            display: none !important;
         }

         .filter-section {
            margin-bottom: 1.5rem;
         }

         .filter-section h3 {
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #aaa;
         }

         .filter-toggle label {
            display: flex;
            align-items: center;
            margin-bottom: 0.6rem;
            font-size: 0.85rem;
            color: #bbb;
            cursor: pointer;
            padding: 0.3rem;
            border-radius: 4px;
            transition: background 0.2s ease;
         }

         .filter-toggle label:hover {
            background: rgba(255, 255, 255, 0.05);
         }

         .filter-toggle input {
            margin-right: 0.6rem;
         }

         .field-line,
         .method-line {
            display: block;
         }

         #searchInput {
            width: 100%;
            margin-bottom: 1.5rem;
            border-radius: 8px !important;
            height: 2.8rem;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 0 1rem;
         }

         #searchInput::placeholder {
            color: rgba(255, 255, 255, 0.5);
         }

         #searchInput:focus {
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
         }

         .section-divider {
            height: 1px;
            background: linear-gradient(
               90deg,
               transparent 0%,
               rgba(255, 255, 255, 0.3) 50%,
               transparent 100%
            );
            margin: 1.5rem 0;
         }

         .subpackage-list {
            list-style: none;
            padding: 0;
         }

         .subpackage-list li {
            margin-bottom: 0.4rem;
         }

         .subpackage-list a {
            display: block;
            padding: 0.5rem 0.8rem;
            color: #ccc;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 0.85rem;
         }

         .subpackage-list a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            transform: translateX(4px);
         }

         .empty-state {
            color: rgba(177, 175, 175, 0.6);
            font-style: italic;
            font-size: 0.8rem;
         }

         .badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            color: #ddd;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
            margin-left: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
         }

         .method-badge {
            background: rgba(100, 200, 255, 0.2);
            color: #87ceeb;
         }

         .const-badge {
            background: rgba(255, 200, 100, 0.2);
            color: #ffd700;
         }

         .var-badge {
            background: rgba(200, 255, 100, 0.2);
            color: #90ee90;
         }

         .type-badge {
            background: rgba(255, 100, 200, 0.2);
            color: #699eff;
         }

         .interface-badge {
            background: rgba(150, 100, 255, 0.2);
            color: #dda0dd;
         }

         .toc {
            position: sticky;
            top: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
         }

         .toc h4 {
            margin: 0 0 0.8rem;
            font-size: 0.9rem;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 0.5px;
         }

         .toc ul {
            list-style: none;
            padding: 0;
            margin: 0;
         }

         .toc li {
            margin-bottom: 0.3rem;
         }

         .toc a {
            color: #bbb;
            text-decoration: none;
            font-size: 0.8rem;
            transition: color 0.2s ease;
         }

         .toc a:hover {
            color: #fff;
         }

         @media (max-width: 768px) {
            body {
               flex-direction: column;
            }

            .sidebar {
               width: 90%;
               height: auto;
               position: relative;
            }

            main {
               max-width: 100%;
               padding: 1rem;
            }
         }
      </style>
   </head>
   <body>
      <aside class="sidebar">
         <div class="nav-links">
            <a href="index.html" title="Home">⌂</a>
            <span>|</span>
            <a href="#" onclick="history.back()" title="Back">←</a>
         </div>

         <div class="filter-section">
            <h3>Search</h3>
            <input
               type="search"
               id="searchInput"
               placeholder="Search symbols..."
            />
         </div>

         <div class="filter-section">
            <h3>Filters</h3>
            <div class="filter-toggle">
               <label>
                  <input type="checkbox" id="showImports" />
                  Show imports
               </label>
               <label>
                  <input type="checkbox" id="showPrivateFunctions" />
                  Show private functions
               </label>
               <label>
                  <input type="checkbox" id="showPrivateStructs" />
                  Show private structs
               </label>
               <label>
                  <input type="checkbox" id="showPrivateFields" />
                  Show private fields
               </label>
               <label>
                  <input type="checkbox" id="showPrivateGlobals" />
                  Show private globals
               </label>
               <label>
                  <input type="checkbox" id="showPrivateTypes" />
                  Show private types
               </label>
               <label>
                  <input type="checkbox" id="showPrivateInterfaces" />
                  Show private interfaces
               </label>
            </div>
         </div>

         <div class="section-divider"></div>

         <div class="filter-section">
            <h3>Subpackages</h3>
            
            <div class="empty-state">No subpackages</div>
            
         </div>

         
         <div class="section-divider"></div>

         <div class="toc">
            <h4>Quick Navigation</h4>
            <ul>
               
               <li><a href="#globals">Constants & Variables</a></li>
                
               <li><a href="#types">Type Aliases</a></li>
                 
               <li><a href="#structs">Structs</a></li>
                
               <li><a href="#functions">Functions</a></li>
               
            </ul>
         </div>
         
      </aside>

      <main>
         <h1>logopt</h1>
         <div class="section-divider"></div>

         
         <section id="imports">
            <h2>Imports</h2>
            <article class="imports" data-name="imports">
               <pre><code>"cmd/internal/obj"
"cmd/internal/src"
"encoding/json"
"fmt"
"internal/buildcfg"
"io"
"log"
"net/url"
"os"
"path/filepath"
"sort"
"strconv"
"strings"
"sync"
"unicode"
</code></pre>
            </article>
         </section>
          
         <section id="globals">
            <h2>Constants & Variables</h2>
            
            <article class="global" data-name="Format">
               <h3>
                  Format 
                  <span class="badge var-badge">var</span>
                  
               </h3>
               
               <pre><code>var Format = None</code></pre>
            </article>
            
            <article class="global" data-name="Json0">
               <h3>
                  Json0 
                  <span class="badge const-badge">const</span>
                  
               </h3>
               
               <pre><code>const Json0</code></pre>
            </article>
            
            <article class="global" data-name="None">
               <h3>
                  None 
                  <span class="badge const-badge">const</span>
                  
               </h3>
               
               <pre><code>const None logFormat = iota</code></pre>
            </article>
            
            <article class="global" data-name="SeverityInformation">
               <h3>
                  SeverityInformation 
                  <span class="badge const-badge">const</span>
                  
               </h3>
               
               <p>SeverityInformation defined:
	 * Reports an information.</p>
               
               <pre><code>const SeverityInformation DiagnosticSeverity = 3</code></pre>
            </article>
            
            <article class="global" data-name="dest">
               <h3>
                  dest 
                  <span class="badge var-badge">var</span>
                  
               </h3>
               
               <pre><code>var dest string</code></pre>
            </article>
            
            <article class="global" data-name="loggedOpts">
               <h3>
                  loggedOpts 
                  <span class="badge var-badge">var</span>
                  
               </h3>
               
               <pre><code>var loggedOpts []*LoggedOpt</code></pre>
            </article>
            
            <article class="global" data-name="mu">
               <h3>
                  mu 
                  <span class="badge var-badge">var</span>
                  
               </h3>
               
               <pre><code>var mu = sync.Mutex{...}</code></pre>
            </article>
            
         </section>
          
         <section id="types">
            <h2>Type Aliases</h2>
            
            <article class="type" data-name="DiagnosticSeverity">
               <h3>
                  DiagnosticSeverity
                  <span class="badge type-badge">type</span>
               </h3>
               
               <p>DiagnosticSeverity defines constants</p>
               
               <pre><code>type DiagnosticSeverity uint</code></pre>
            </article>
            
            <article class="type" data-name="DiagnosticTag">
               <h3>
                  DiagnosticTag
                  <span class="badge type-badge">type</span>
               </h3>
               
               <p>DiagnosticTag defines constants</p>
               
               <pre><code>type DiagnosticTag uint</code></pre>
            </article>
            
            <article class="type" data-name="DocumentURI">
               <h3>
                  DocumentURI
                  <span class="badge type-badge">type</span>
               </h3>
               
               <pre><code>type DocumentURI string</code></pre>
            </article>
            
            <article class="type" data-name="logFormat">
               <h3>
                  logFormat
                  <span class="badge type-badge">type</span>
               </h3>
               
               <pre><code>type logFormat uint8</code></pre>
            </article>
            
         </section>
           
         <section id="structs">
            <h2>Structs</h2>
            
            <article class="struct" data-name="Diagnostic">
               <h3>
                  Diagnostic
                  <span class="badge">struct</span>
               </h3>
               
               <p>Diagnostic defined:
 * Represents a diagnostic, such as a compiler error or warning. Diagnostic objects
 * are only valid in the scope of a resource.</p>
               
               <pre
                  class="fields-block"
               ><code class="fields-code">type Diagnostic struct {
Range Range `json:"range"`
Severity DiagnosticSeverity `json:"severity,omitempty"`
Code string `json:"code,omitempty"`
Source string `json:"source,omitempty"`
Message string `json:"message"`
Tags []DiagnosticTag `json:"tags,omitempty"`
RelatedInformation []DiagnosticRelatedInformation `json:"relatedInformation,omitempty"`
}</code></pre>
            </article>
            
            <article class="struct" data-name="DiagnosticRelatedInformation">
               <h3>
                  DiagnosticRelatedInformation
                  <span class="badge">struct</span>
               </h3>
               
               <p>DiagnosticRelatedInformation defined:
 * Represents a related message and source code location for a diagnostic. This should be
 * used to point to code locations that cause or related to a diagnostics, e.g when duplicating
 * a symbol in a scope.</p>
               
               <pre
                  class="fields-block"
               ><code class="fields-code">type DiagnosticRelatedInformation struct {
Location Location `json:"location"`
Message string `json:"message"`
}</code></pre>
            </article>
            
            <article class="struct" data-name="Location">
               <h3>
                  Location
                  <span class="badge">struct</span>
               </h3>
               
               <p>A Location represents a location inside a resource, such as a line inside a text file.</p>
               
               <pre
                  class="fields-block"
               ><code class="fields-code">type Location struct {
URI DocumentURI `json:"uri"`
Range Range `json:"range"`
}</code></pre>
            </article>
            
            <article class="struct" data-name="LoggedOpt">
               <h3>
                  LoggedOpt
                  <span class="badge">struct</span>
               </h3>
               
               <p>A LoggedOpt is what the compiler produces and accumulates,
to be converted to JSON for human or IDE consumption.</p>
               
               <pre
                  class="fields-block"
               ><code class="fields-code">type LoggedOpt struct {
pos src.XPos
lastPos src.XPos
compilerPass string
functionName string
what string
target []interface{}
}</code></pre>
            </article>
            
            <article class="struct" data-name="Position">
               <h3>
                  Position
                  <span class="badge">struct</span>
               </h3>
               
               <pre
                  class="fields-block"
               ><code class="fields-code">type Position struct {
Line uint `json:"line"`
Character uint `json:"character"`
}</code></pre>
            </article>
            
            <article class="struct" data-name="Range">
               <h3>
                  Range
                  <span class="badge">struct</span>
               </h3>
               
               <p>A Range in a text document expressed as (zero-based) start and end positions.
A range is comparable to a selection in an editor. Therefore the end position is exclusive.
If you want to specify a range that contains a line including the line ending character(s)
then use an end position denoting the start of the next line.</p>
               
               <pre
                  class="fields-block"
               ><code class="fields-code">type Range struct {
Start Position `json:"start"`
End Position `json:"end"`
}</code></pre>
            </article>
            
            <article class="struct" data-name="VersionHeader">
               <h3>
                  VersionHeader
                  <span class="badge">struct</span>
               </h3>
               
               <pre
                  class="fields-block"
               ><code class="fields-code">type VersionHeader struct {
Version int `json:"version"`
Package string `json:"package"`
Goos string `json:"goos"`
Goarch string `json:"goarch"`
GcVersion string `json:"gc_version"`
File string `json:"file,omitempty"`
}</code></pre>
            </article>
            
            <article class="struct" data-name="byPos">
               <h3>
                  byPos
                  <span class="badge">struct</span>
               </h3>
               
               <p>byPos sorts diagnostics by source position.</p>
               
               <pre
                  class="fields-block"
               ><code class="fields-code">type byPos struct {
ctxt *obj.Link
a []*LoggedOpt
}</code></pre>
            </article>
            
         </section>
          
         <section id="functions">
            <h2>Functions</h2>
            
            <article class="function" data-name="Enabled">
               <h3>
                  Enabled 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>Enabled returns whether optimization logging is enabled.</p>
               
               <pre><code>func Enabled() bool</code></pre>
            </article>
            
            <article class="function" data-name="FlushLoggedOpts">
               <h3>
                  FlushLoggedOpts 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>FlushLoggedOpts flushes all the accumulated optimization log entries.</p>
               
               <pre><code>func FlushLoggedOpts(ctxt *obj.Link, slashPkgPath string)</code></pre>
            </article>
            
            <article class="function" data-name="Len">
               <h3>
                  Len 
                  <span class="badge method-badge">method</span>
                  
               </h3>
               
               <pre><code>func (x byPos) Len() int</code></pre>
            </article>
            
            <article class="function" data-name="Less">
               <h3>
                  Less 
                  <span class="badge method-badge">method</span>
                  
               </h3>
               
               <pre><code>func (x byPos) Less(i int, j int) bool</code></pre>
            </article>
            
            <article class="function" data-name="LogJsonOption">
               <h3>
                  LogJsonOption 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>LogJsonOption parses and validates the version,directory value attached to the -json compiler flag.</p>
               
               <pre><code>func LogJsonOption(flagValue string)</code></pre>
            </article>
            
            <article class="function" data-name="LogOpt">
               <h3>
                  LogOpt 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>LogOpt logs information about a (usually missed) optimization performed by the compiler.
Pos is the source position (including inlining), what is the message, pass is which pass created the message,
funcName is the name of the function.</p>
               
               <pre><code>func LogOpt(pos src.XPos, what string, pass string, funcName string, args ...interface{})</code></pre>
            </article>
            
            <article class="function" data-name="LogOptRange">
               <h3>
                  LogOptRange 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>LogOptRange is the same as LogOpt, but includes the ability to express a range of positions,
not just a point.</p>
               
               <pre><code>func LogOptRange(pos src.XPos, lastPos src.XPos, what string, pass string, funcName string, args ...interface{})</code></pre>
            </article>
            
            <article class="function" data-name="NewLoggedOpt">
               <h3>
                  NewLoggedOpt 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>NewLoggedOpt allocates a new LoggedOpt, to later be passed to either NewLoggedOpt or LogOpt as "args".
Pos is the source position (including inlining), what is the message, pass is which pass created the message,
funcName is the name of the function
A typical use for this to accumulate an explanation for a missed optimization, for example, why did something escape?</p>
               
               <pre><code>func NewLoggedOpt(pos src.XPos, lastPos src.XPos, what string, pass string, funcName string, args ...interface{}) *LoggedOpt</code></pre>
            </article>
            
            <article class="function" data-name="Swap">
               <h3>
                  Swap 
                  <span class="badge method-badge">method</span>
                  
               </h3>
               
               <pre><code>func (x byPos) Swap(i int, j int)</code></pre>
            </article>
            
            <article class="function" data-name="appendInlinedPos">
               <h3>
                  appendInlinedPos 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>appendInlinedPos extracts inlining information from posTmp and append it to diagnostic.</p>
               
               <pre><code>func appendInlinedPos(posTmp []src.Pos, lastTmp []src.Pos, diagnostic *Diagnostic)</code></pre>
            </article>
            
            <article class="function" data-name="checkLogPath">
               <h3>
                  checkLogPath 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>checkLogPath does superficial early checking of the string specifying
the directory to which optimizer logging is directed, and if
it passes the test, stores the string in LO_dir.</p>
               
               <pre><code>func checkLogPath(destination string) string</code></pre>
            </article>
            
            <article class="function" data-name="fixSlash">
               <h3>
                  fixSlash 
                  <span class="badge">function</span>
                  
               </h3>
               
               <pre><code>func fixSlash(f string) string</code></pre>
            </article>
            
            <article class="function" data-name="isWindowsDriveURIPath">
               <h3>
                  isWindowsDriveURIPath 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>isWindowsDriveURIPath returns true if the file URI is of the format used by
Windows URIs. The url.Parse package does not specially handle Windows paths
(see golang/go#6027), so we check if the URI path has a drive prefix (e.g. "/C:").
(copied from tools/internal/span/uri.go)
this is less comprehensive that the processing in filepath.IsAbs on Windows.</p>
               
               <pre><code>func isWindowsDriveURIPath(uri string) bool</code></pre>
            </article>
            
            <article class="function" data-name="newLocation">
               <h3>
                  newLocation 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>newLocation returns the Location for the compiler source location p.</p>
               
               <pre><code>func newLocation(p src.Pos, last src.Pos) Location</code></pre>
            </article>
            
            <article class="function" data-name="newRange">
               <h3>
                  newRange 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>newRange returns a single-position Range for the compiler source location p.</p>
               
               <pre><code>func newRange(p src.Pos, last src.Pos) Range</code></pre>
            </article>
            
            <article class="function" data-name="parseLogFlag">
               <h3>
                  parseLogFlag 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>parseLogFlag checks the flag passed to -json
for version,destination format and returns the two parts.</p>
               
               <pre><code>func parseLogFlag(flag string, value string) (version int, directory string)</code></pre>
            </article>
            
            <article class="function" data-name="parseLogPath">
               <h3>
                  parseLogPath 
                  <span class="badge">function</span>
                  
               </h3>
               
               <pre><code>func parseLogPath(destination string) (string, string)</code></pre>
            </article>
            
            <article class="function" data-name="parsePos">
               <h3>
                  parsePos 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>parsePos expands a src.XPos into a slice of src.Pos, with the outermost first.
It returns the slice, and the outermost.</p>
               
               <pre><code>func parsePos(ctxt *obj.Link, pos src.XPos, posTmp []src.Pos) ([]src.Pos, src.Pos)</code></pre>
            </article>
            
            <article class="function" data-name="uprootedPath">
               <h3>
                  uprootedPath 
                  <span class="badge">function</span>
                  
               </h3>
               
               <p>Return filename, replacing a first occurrence of $GOROOT with the
actual value of the GOROOT (because LSP does not speak "$GOROOT").</p>
               
               <pre><code>func uprootedPath(filename string) string</code></pre>
            </article>
            
            <article class="function" data-name="uriIfy">
               <h3>
                  uriIfy 
                  <span class="badge">function</span>
                  
               </h3>
               
               <pre><code>func uriIfy(f string) DocumentURI</code></pre>
            </article>
            
            <article class="function" data-name="writerForLSP">
               <h3>
                  writerForLSP 
                  <span class="badge">function</span>
                  
               </h3>
               
               <pre><code>func writerForLSP(subdirpath string, file string) io.WriteCloser</code></pre>
            </article>
            
         </section>
         
      </main>

      <script>
         function isPrivate(name) {
            return /^[a-z]/.test(name);
         }

         document.addEventListener("DOMContentLoaded", () => {
            const toggles = {
               functions: document.getElementById("showPrivateFunctions"),
               imports: document.getElementById("showImports"),
               structs: document.getElementById("showPrivateStructs"),
               fields: document.getElementById("showPrivateFields"),
               globals: document.getElementById("showPrivateGlobals"),
               types: document.getElementById("showPrivateTypes"),
               interfaces: document.getElementById(
                  "showPrivateInterfaces"
               ),
            };

            const hideInitial = (selector, toggle) => {
               document.querySelectorAll(selector).forEach((el) => {
                  const name = el.dataset.name;
                  if (isPrivate(name)) {
                     el.classList.add("private", "hidden");
                  }
               });

               if (toggle) {
                  toggle.addEventListener("change", () => {
                     const show = toggle.checked;
                     document
                        .querySelectorAll(`${selector}.private`)
                        .forEach((el) => {
                           el.classList.toggle("hidden", !show);
                        });
                  });
               }
            };

            hideInitial("article.imports", toggles.imports);
            hideInitial("article.function", toggles.functions);
            hideInitial("article.struct", toggles.structs);
            hideInitial("article.global", toggles.globals);
            hideInitial("article.type", toggles.types);
            hideInitial("article.interface", toggles.interfaces);

            document
               .querySelectorAll("article.struct")
               .forEach((article) => {
                  const codeBlock =
                     article.querySelector("code.fields-code");
                  if (!codeBlock) return;

                  const lines = codeBlock.innerHTML.split("\n");
                  const newContent = lines
                     .map((line) => {
                        const trimmed = line.trim();
                        const nameMatch = trimmed.match(
                           /^([A-Za-z_][A-Za-z0-9_]*)/
                        );
                        if (!nameMatch && trimmed != "}") {
                           return `<span class="field-line">${line}</span>`;
                        }
                        if (nameMatch == null) return;
                        const name = nameMatch[1];
                        const isPriv = isPrivate(name);
                        return `<span class="field-line${
                           isPriv ? " hidden private" : ""
                        }" data-name="${name}">${line}</span>`;
                     })
                     .join("");

                  codeBlock.innerHTML = newContent;

                  if (toggles.fields) {
                     toggles.fields.addEventListener("change", () => {
                        const show = toggles.fields.checked;
                        article
                           .querySelectorAll(".field-line.private")
                           .forEach((el) =>
                              el.classList.toggle("hidden", !show)
                           );
                     });
                  }
               });

            // Handle private methods in interfaces
            document
               .querySelectorAll("article.interface")
               .forEach((article) => {
                  const codeBlock = article.querySelector(
                     "code.methods-code"
                  );
                  if (!codeBlock) return;

                  const lines = codeBlock.innerHTML.split("\n");
                  const newContent = lines
                     .map((line) => {
                        const trimmed = line.trim();
                        const nameMatch = trimmed.match(
                           /^([A-Za-z_][A-Za-z0-9_]*)/
                        );
                        if (!nameMatch) {
                           return `<span class="method-line">${line}</span>`;
                        }

                        const name = nameMatch[1];
                        const isPriv = isPrivate(name);
                        return `<span class="method-line${
                           isPriv ? " hidden private" : ""
                        }" data-name="${name}">${line}</span>`;
                     })
                     .join("");

                  codeBlock.innerHTML = newContent;

                  if (toggles.fields) {
                     // Reuse fields toggle for interface methods
                     toggles.fields.addEventListener("change", () => {
                        const show = toggles.fields.checked;
                        article
                           .querySelectorAll(".method-line.private")
                           .forEach((el) =>
                              el.classList.toggle("hidden", !show)
                           );
                     });
                  }
               });

            const searchInput = document.getElementById("searchInput");
            if (searchInput) {
               searchInput.addEventListener("input", () => {
                  const query = searchInput.value.trim().toLowerCase();

                  document.querySelectorAll("article").forEach((el) => {
                     const name = el.dataset.name;
                     if (!name) return;

                     const matches =
                        query === "" ||
                        name.toLowerCase().includes(query) ||
                        (el.textContent &&
                           el.textContent.toLowerCase().includes(query));

                     if (matches) {
                        // Only show if not hidden by privacy filters
                        const isPrivateEl =
                           el.classList.contains("private");
                        const shouldShowPrivate =
                           getPrivateToggleState(el);

                        if (!isPrivateEl || shouldShowPrivate) {
                           el.classList.remove("hidden");
                        }
                     } else {
                        el.classList.add("hidden");
                     }
                  });
               });
            }

            // Helper function to check if private elements should be shown
            function getPrivateToggleState(element) {
               if (element.classList.contains("function")) {
                  return toggles.functions?.checked || false;
               } else if (element.classList.contains("struct")) {
                  return toggles.structs?.checked || false;
               } else if (element.classList.contains("global")) {
                  return toggles.globals?.checked || false;
               } else if (element.classList.contains("type")) {
                  return toggles.types?.checked || false;
               } else if (element.classList.contains("interface")) {
                  return toggles.interfaces?.checked || false;
               } else if (element.classList.contains("imports")) {
                  return toggles.imports?.checked || false;
               }
               return false;
            }

            document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
               anchor.addEventListener("click", function (e) {
                  e.preventDefault();
                  const target = document.querySelector(
                     this.getAttribute("href")
                  );
                  if (target) {
                     target.scrollIntoView({
                        behavior: "smooth",
                        block: "start",
                     });
                  }
               });
            });
         });
      </script>
   </body>
</html>
