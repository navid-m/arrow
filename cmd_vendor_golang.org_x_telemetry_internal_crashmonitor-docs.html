<!DOCTYPE html>
<html lang="en" data-theme="dark">
   <head>
      <meta charset="UTF-8" />
      <meta
         name="viewport"
         content="width=device-width, initial-scale=1.0"
      />
      <title>Docs - crashmonitor</title>
      <link
         href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"
         rel="stylesheet"
      />
      <style>
         html {
            font-size: 13px;
         }
         body {
            display: flex;
            min-height: 100vh;
            margin: 0;
         }
         .sidebar {
            width: 200px;
            background: rgba(59, 56, 56, 0.1);
            padding: 1.2rem;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
            margin-right: 7px;
         }
         main {
            flex: 0.9;
            padding: 1rem;
            margin: 0;
            max-width: calc(100% - 220px);
         }
         h1 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
         }
         h2 {
            font-size: 1.2rem;
            margin: 0.3rem 0 0.2rem;
         }
         pre {
            background: #1e1e1e;
            color: #dcdcdc;
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            margin: 0 0 1rem;
            font-size: 0.85rem;
            overflow-x: auto;
         }
         code {
            color: #f0dbdb;
            white-space: pre-wrap;
         }
         p {
            font-size: 15px;
            padding-top: 10px;
         }
         article {
            margin-bottom: 0.5rem;
            padding: 0.4rem 0.9rem;
            background: rgba(59, 56, 56, 0.5);
            border-radius: 10px;
            max-width: 99%;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);
         }
         .hidden {
            display: none;
         }
         .filter-toggle label {
            display: block;
            margin-bottom: 0.5rem;
         }
         .field-line {
            display: block;
         }
      </style>
   </head>
   <body>
      <aside class="sidebar">
         <a href="index.html">⌂</a>
         |
         <a href="#" onclick="history.back()">←</a>
         <hr style="opacity: 0" />
         <h2>Filters</h2>
         <hr />
         <input
            type="search"
            id="searchInput"
            placeholder="Search symbols..."
            style="
               width: 100%;
               margin-bottom: 1rem;
               margin-top: 0.8rem;
               border-radius: 10px !important;
               height: 50px;
               height: 2.5rem;
            "
         />
         <div class="filter-toggle">
            <label>
               <input type="checkbox" id="showPrivateFunctions" />
               Show private functions
            </label>
            <label>
               <input type="checkbox" id="showPrivateStructs" />
               Show private structs
            </label>
            <label>
               <input type="checkbox" id="showPrivateFields" />
               Show private struct fields
            </label>
            <label>
               <input type="checkbox" id="showPrivateGlobals" />
               Show private globals
            </label>
         </div>
         <hr style="opacity: 0" />
         <h2 style="padding-top: 5px">Subpackages</h2>
         <hr />
         
         <span style="color: rgba(177, 175, 175, 0.5)">
            No subpackages
         </span>
         
      </aside>
      <main>
         <h1>
            Package
            <code>crashmonitor</code>
         </h1>
         <hr />
         
         <article class="global" data-name="setCrashOutput">
            <h2>setCrashOutput</h2>
            <hr />
            
            <pre><code>setCrashOutput func</code></pre>
         </article>
         
         <article class="global" data-name="incrementCounter">
            <h2>incrementCounter</h2>
            <hr />
            
            <p>(stubbed by test)</p>
            
            <pre><code>incrementCounter</code></pre>
         </article>
         
         <article class="global" data-name="childExitHook">
            <h2>childExitHook</h2>
            <hr />
            
            <p>(stubbed by test)</p>
            
            <pre><code>childExitHook</code></pre>
         </article>
           
         <article class="function" data-name="init">
            <h2>init</h2>
            <hr />
            
            <pre><code>func init()</code></pre>
         </article>
         
         <article class="function" data-name="Supported">
            <h2>Supported</h2>
            <hr />
            
            <p>Supported reports whether the runtime supports [runtime/debug.SetCrashOutput].

TODO(adonovan): eliminate once go1.23+ is assured.</p>
            
            <pre><code>func Supported() bool</code></pre>
         </article>
         
         <article class="function" data-name="Parent">
            <h2>Parent</h2>
            <hr />
            
            <p>Parent sets up the parent side of the crashmonitor. It requires
exclusive use of a writable pipe connected to the child process's stdin.</p>
            
            <pre><code>func Parent(pipe *os.File)</code></pre>
         </article>
         
         <article class="function" data-name="Child">
            <h2>Child</h2>
            <hr />
            
            <p>Child runs the part of the crashmonitor that runs in the child process.
It expects its stdin to be connected via a pipe to the parent which has
run Parent.</p>
            
            <pre><code>func Child()</code></pre>
         </article>
         
         <article class="function" data-name="sentinel">
            <h2>sentinel</h2>
            <hr />
            
            <p>The sentinel function returns its address. The difference between
this value as observed by calls in two different processes of the
same executable tells us the relative offset of their text segments.

It would be nice if SetCrashOutput took care of this as it's fiddly
and likely to confuse every user at first.</p>
            
            <pre><code>func sentinel() uint64</code></pre>
         </article>
         
         <article class="function" data-name="writeSentinel">
            <h2>writeSentinel</h2>
            <hr />
            
            <pre><code>func writeSentinel(out io.Writer)</code></pre>
         </article>
         
         <article class="function" data-name="telemetryCounterName">
            <h2>telemetryCounterName</h2>
            <hr />
            
            <p>telemetryCounterName parses a crash report produced by the Go
runtime, extracts the stack of the first runnable goroutine,
converts each line into telemetry form ("symbol:relative-line"),
and returns this as the name of a counter.</p>
            
            <pre><code>func telemetryCounterName(crash []byte) (string, error)</code></pre>
         </article>
         
         <article class="function" data-name="parseStackPCs">
            <h2>parseStackPCs</h2>
            <hr />
            
            <p>parseStackPCs parses the parent process's program counters for the
first running goroutine out of a GOTRACEBACK=system traceback,
adjusting them so that they are valid for the child process's text
segment.

This function returns only program counter values, ensuring that
there is no possibility of strings from the crash report (which may
contain PII) leaking into the telemetry system.</p>
            
            <pre><code>func parseStackPCs(crash string) ([]uintptr, error)</code></pre>
         </article>
         
         <article class="function" data-name="min">
            <h2>min</h2>
            <hr />
            
            <pre><code>func min(x int, y int) int</code></pre>
         </article>
         
      </main>
      <script>
         function isPrivate(name) {
            return /^[a-z]/.test(name);
         }
         document.addEventListener("DOMContentLoaded", () => {
            const toggles = {
               functions: document.getElementById("showPrivateFunctions"),
               structs: document.getElementById("showPrivateStructs"),
               fields: document.getElementById("showPrivateFields"),
               globals: document.getElementById("showPrivateGlobals"),
            };
            const hideInitial = (selector, toggle) => {
               document.querySelectorAll(selector).forEach((el) => {
                  const name = el.dataset.name;
                  if (isPrivate(name)) {
                     el.classList.add("private", "hidden");
                  }
               });
               toggle.addEventListener("change", () => {
                  const show = toggle.checked;
                  document
                     .querySelectorAll(`${selector}.private`)
                     .forEach((el) => {
                        el.classList.toggle("hidden", !show);
                     });
               });
            };
            hideInitial("article.function", toggles.functions);
            hideInitial("article.struct", toggles.structs);
            hideInitial("article.global", toggles.globals);
            document
               .querySelectorAll("article.struct")
               .forEach((article) => {
                  const codeBlock =
                     article.querySelector("code.fields-code");
                  if (!codeBlock) return;
                  const lines = codeBlock.innerText.split("\n");
                  const newContent = lines
                     .map((line) => {
                        const trimmed = line.trim();
                        const nameMatch = trimmed.match(
                           /^([A-Za-z_][A-Za-z0-9_]*)/
                        );
                        if (!nameMatch)
                           return `<span class=\"field-line\">${line}</span>`;
                        const name = nameMatch[1];
                        const isPriv = isPrivate(name);
                        return `<span class=\"field-line${
                           isPriv ? " hidden private" : ""
                        }\" data-name=\"${name}\">${line}</span>`;
                     })
                     .join("");
                  codeBlock.innerHTML = newContent;
                  toggles.fields.addEventListener("change", () => {
                     const show = toggles.fields.checked;
                     article
                        .querySelectorAll(".field-line.private")
                        .forEach((el) =>
                           el.classList.toggle("hidden", !show)
                        );
                  });
               });
            const searchInput = document.getElementById("searchInput");
            searchInput.addEventListener("input", () => {
               const query = searchInput.value.trim().toLowerCase();
               document.querySelectorAll("article").forEach((el) => {
                  const name = el.dataset.name.toLowerCase();
                  if (query === "" || name.includes(query)) {
                     el.classList.remove("hidden");
                  } else {
                     el.classList.add("hidden");
                  }
               });
            });
         });
      </script>
   </body>
</html>
