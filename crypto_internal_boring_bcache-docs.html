<!DOCTYPE html>
<html lang="en" data-theme="dark">
   <head>
      <meta charset="UTF-8" />
      <meta
         name="viewport"
         content="width=device-width, initial-scale=1.0"
      />
      <title>Docs - bcache</title>
      <link
         href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"
         rel="stylesheet"
      />
      <style>
         html {
            font-size: 13px;
         }
         body {
            display: flex;
            min-height: 100vh;
            margin: 0;
         }
         .sidebar {
            width: 200px;
            background: rgba(59, 56, 56, 0.1);
            padding: 1.2rem;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
            margin-right: 7px;
         }
         main {
            flex: 0.9;
            padding: 1rem;
            margin: 0;
            max-width: calc(100% - 220px);
         }
         h1 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
         }
         h2 {
            font-size: 1.2rem;
            margin: 0.3rem 0 0.2rem;
         }
         pre {
            background: #1e1e1e;
            color: #dcdcdc;
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            margin: 0 0 1rem;
            font-size: 0.85rem;
            overflow-x: auto;
         }
         code {
            color: #f0dbdb;
            white-space: pre-wrap;
         }
         p {
            font-size: 15px;
            padding-top: 10px;
         }
         article {
            margin-bottom: 0.5rem;
            padding: 0.4rem 0.9rem;
            background: rgba(59, 56, 56, 0.5);
            border-radius: 10px;
            max-width: 99%;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);
         }
         .hidden {
            display: none;
         }
         .filter-toggle label {
            display: block;
            margin-bottom: 0.5rem;
         }
         .field-line {
            display: block;
         }
      </style>
   </head>
   <body>
      <aside class="sidebar">
         <a href="index.html">⌂</a>
         |
         <a href="#" onclick="history.back()">←</a>
         <hr style="opacity: 0" />
         <h2>Filters</h2>
         <hr />
         <input
            type="search"
            id="searchInput"
            placeholder="Search symbols..."
            style="
               width: 100%;
               margin-bottom: 1rem;
               margin-top: 0.8rem;
               border-radius: 10px !important;
               height: 50px;
               height: 2.5rem;
            "
         />
         <div class="filter-toggle">
            <label>
               <input type="checkbox" id="showPrivateFunctions" />
               Show private functions
            </label>
            <label>
               <input type="checkbox" id="showPrivateStructs" />
               Show private structs
            </label>
            <label>
               <input type="checkbox" id="showPrivateFields" />
               Show private struct fields
            </label>
            <label>
               <input type="checkbox" id="showPrivateGlobals" />
               Show private globals
            </label>
         </div>
         <hr style="opacity: 0" />
         <h2 style="padding-top: 5px">Subpackages</h2>
         <hr />
         
         <span style="color: rgba(177, 175, 175, 0.5)">
            No subpackages
         </span>
         
      </aside>
      <main>
         <h1>
            Package
            <code>bcache</code>
         </h1>
         <hr />
         
         <article class="global" data-name="registeredCache">
            <h2>registeredCache</h2>
            <hr />
            
            <pre><code>registeredCache *ast.IndexListExpr</code></pre>
         </article>
         
         <article class="global" data-name="seq">
            <h2>seq</h2>
            <hr />
            
            <pre><code>seq atomic.Uint32</code></pre>
         </article>
         
         <article class="global" data-name="cacheSize">
            <h2>cacheSize</h2>
            <hr />
            
            <p>cacheSize is the number of entries in the hash table.
The hash is the pointer value mod cacheSize, a prime.
Collisions are resolved by maintaining a linked list in each hash slot.</p>
            
            <pre><code>cacheSize</code></pre>
         </article>
          
         <article class="struct" data-name="Cache">
            <h2>type Cache struct</h2>
            <hr />
            
            <p>A Cache is a GC-friendly concurrent map from unsafe.Pointer to
unsafe.Pointer. It is meant to be used for maintaining shadow
BoringCrypto state associated with certain allocated structs, in
particular public and private RSA and ECDSA keys.

The cache is GC-friendly in the sense that the keys do not
indefinitely prevent the garbage collector from collecting them.
Instead, at the start of each GC, the cache is cleared entirely. That
is, the cache is lossy, and the loss happens at the start of each GC.
This means that clients need to be able to cope with cache entries
disappearing, but it also means that clients don't need to worry about
cache entries keeping the keys from being collected.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">ptable *ast.IndexExpr</code></pre>
         </article>
         
         <article class="struct" data-name="cacheEntry">
            <h2>type cacheEntry struct</h2>
            <hr />
            
            <p>A cacheEntry is a single entry in the linked list for a given hash table entry.</p>
            
            <pre
               class="fields-block"
            ><code class="fields-code">k *K
v *ast.IndexExpr
next **ast.IndexListExpr</code></pre>
         </article>
          
         <article class="function" data-name="init">
            <h2>init</h2>
            <hr />
            
            <pre><code>func init()</code></pre>
         </article>
         
         <article class="function" data-name="next">
            <h2>next</h2>
            <hr />
            
            <pre><code>func next() *T</code></pre>
         </article>
         
         <article class="function" data-name="str">
            <h2>str</h2>
            <hr />
            
            <pre><code>func str(x *T) string</code></pre>
         </article>
         
         <article class="function" data-name="TestCache">
            <h2>TestCache</h2>
            <hr />
            
            <pre><code>func TestCache(t *testing.T)</code></pre>
         </article>
         
         <article class="function" data-name="registerCache">
            <h2>registerCache</h2>
            <hr />
            
            <pre><code>func registerCache(unsafe.Pointer)</code></pre>
         </article>
         
         <article class="function" data-name="Register">
            <h2>Register</h2>
            <hr />
            
            <p>Register registers the cache with the runtime,
so that c.ptable can be cleared at the start of each GC.
Register must be called during package initialization.</p>
            
            <pre><code>func Register()</code></pre>
         </article>
         
         <article class="function" data-name="table">
            <h2>table</h2>
            <hr />
            
            <p>table returns a pointer to the current cache hash table,
coping with the possibility of the GC clearing it out from under us.</p>
            
            <pre><code>func table() **ast.IndexListExpr</code></pre>
         </article>
         
         <article class="function" data-name="Clear">
            <h2>Clear</h2>
            <hr />
            
            <p>Clear clears the cache.
The runtime does this automatically at each garbage collection;
this method is exposed only for testing.</p>
            
            <pre><code>func Clear()</code></pre>
         </article>
         
         <article class="function" data-name="Get">
            <h2>Get</h2>
            <hr />
            
            <p>Get returns the cached value associated with v,
which is either the value v corresponding to the most recent call to Put(k, v)
or nil if that cache entry has been dropped.</p>
            
            <pre><code>func Get(k *K) *V</code></pre>
         </article>
         
         <article class="function" data-name="Put">
            <h2>Put</h2>
            <hr />
            
            <p>Put sets the cached value associated with k to v.</p>
            
            <pre><code>func Put(k *K, v *V)</code></pre>
         </article>
         
      </main>
      <script>
         function isPrivate(name) {
            return /^[a-z]/.test(name);
         }
         document.addEventListener("DOMContentLoaded", () => {
            const toggles = {
               functions: document.getElementById("showPrivateFunctions"),
               structs: document.getElementById("showPrivateStructs"),
               fields: document.getElementById("showPrivateFields"),
               globals: document.getElementById("showPrivateGlobals"),
            };
            const hideInitial = (selector, toggle) => {
               document.querySelectorAll(selector).forEach((el) => {
                  const name = el.dataset.name;
                  if (isPrivate(name)) {
                     el.classList.add("private", "hidden");
                  }
               });
               toggle.addEventListener("change", () => {
                  const show = toggle.checked;
                  document
                     .querySelectorAll(`${selector}.private`)
                     .forEach((el) => {
                        el.classList.toggle("hidden", !show);
                     });
               });
            };
            hideInitial("article.function", toggles.functions);
            hideInitial("article.struct", toggles.structs);
            hideInitial("article.global", toggles.globals);
            document
               .querySelectorAll("article.struct")
               .forEach((article) => {
                  const codeBlock =
                     article.querySelector("code.fields-code");
                  if (!codeBlock) return;
                  const lines = codeBlock.innerText.split("\n");
                  const newContent = lines
                     .map((line) => {
                        const trimmed = line.trim();
                        const nameMatch = trimmed.match(
                           /^([A-Za-z_][A-Za-z0-9_]*)/
                        );
                        if (!nameMatch)
                           return `<span class=\"field-line\">${line}</span>`;
                        const name = nameMatch[1];
                        const isPriv = isPrivate(name);
                        return `<span class=\"field-line${
                           isPriv ? " hidden private" : ""
                        }\" data-name=\"${name}\">${line}</span>`;
                     })
                     .join("");
                  codeBlock.innerHTML = newContent;
                  toggles.fields.addEventListener("change", () => {
                     const show = toggles.fields.checked;
                     article
                        .querySelectorAll(".field-line.private")
                        .forEach((el) =>
                           el.classList.toggle("hidden", !show)
                        );
                  });
               });
            const searchInput = document.getElementById("searchInput");
            searchInput.addEventListener("input", () => {
               const query = searchInput.value.trim().toLowerCase();
               document.querySelectorAll("article").forEach((el) => {
                  const name = el.dataset.name.toLowerCase();
                  if (query === "" || name.includes(query)) {
                     el.classList.remove("hidden");
                  } else {
                     el.classList.add("hidden");
                  }
               });
            });
         });
      </script>
   </body>
</html>
