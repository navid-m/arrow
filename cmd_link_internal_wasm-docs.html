<!DOCTYPE html>
<html lang="en" data-theme="dark">
   <head>
      <meta charset="UTF-8" />
      <meta
         name="viewport"
         content="width=device-width, initial-scale=1.0"
      />
      <title>Docs - wasm</title>
      <link
         href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"
         rel="stylesheet"
      />
      <style>
         html {
            font-size: 13px;
         }
         body {
            display: flex;
            min-height: 100vh;
            margin: 0;
         }
         .sidebar {
            width: 200px;
            background: rgba(59, 56, 56, 0.1);
            padding: 1.2rem;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
            margin-right: 7px;
         }
         main {
            flex: 0.9;
            padding: 1rem;
            margin: 0;
            max-width: calc(100% - 220px);
         }
         h1 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
         }
         h2 {
            font-size: 1.2rem;
            margin: 0.3rem 0 0.2rem;
         }
         pre {
            background: #1e1e1e;
            color: #dcdcdc;
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            margin: 0 0 1rem;
            font-size: 0.85rem;
            overflow-x: auto;
         }
         code {
            color: #f0dbdb;
            white-space: pre-wrap;
         }
         p {
            font-size: 15px;
            padding-top: 10px;
         }
         article {
            margin-bottom: 0.5rem;
            padding: 0.4rem 0.9rem;
            background: rgba(59, 56, 56, 0.5);
            border-radius: 10px;
            max-width: 99%;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);
         }
         .hidden {
            display: none;
         }
         .filter-toggle label {
            display: block;
            margin-bottom: 0.5rem;
         }
         .field-line {
            display: block;
         }
      </style>
   </head>
   <body>
      <aside class="sidebar">
         <a href="index.html">⌂</a>
         |
         <a href="#" onclick="history.back()">←</a>
         <hr style="opacity: 0" />
         <h2>Filters</h2>
         <hr />
         <input
            type="search"
            id="searchInput"
            placeholder="Search symbols..."
            style="
               width: 100%;
               margin-bottom: 1rem;
               margin-top: 0.8rem;
               border-radius: 10px !important;
               height: 50px;
               height: 2.5rem;
            "
         />
         <div class="filter-toggle">
            <label>
               <input type="checkbox" id="showPrivateFunctions" />
               Show private functions
            </label>
            <label>
               <input type="checkbox" id="showPrivateStructs" />
               Show private structs
            </label>
            <label>
               <input type="checkbox" id="showPrivateFields" />
               Show private struct fields
            </label>
            <label>
               <input type="checkbox" id="showPrivateGlobals" />
               Show private globals
            </label>
         </div>
         <hr style="opacity: 0" />
         <h2 style="padding-top: 5px">Subpackages</h2>
         <hr />
         
         <span style="color: rgba(177, 175, 175, 0.5)">
            No subpackages
         </span>
         
      </aside>
      <main>
         <h1>
            Package
            <code>wasm</code>
         </h1>
         <hr />
         
         <article class="global" data-name="I32">
            <h2>I32</h2>
            <hr />
            
            <pre><code>I32</code></pre>
         </article>
         
         <article class="global" data-name="I64">
            <h2>I64</h2>
            <hr />
            
            <pre><code>I64</code></pre>
         </article>
         
         <article class="global" data-name="F32">
            <h2>F32</h2>
            <hr />
            
            <pre><code>F32</code></pre>
         </article>
         
         <article class="global" data-name="F64">
            <h2>F64</h2>
            <hr />
            
            <pre><code>F64</code></pre>
         </article>
         
         <article class="global" data-name="sectionCustom">
            <h2>sectionCustom</h2>
            <hr />
            
            <pre><code>sectionCustom</code></pre>
         </article>
         
         <article class="global" data-name="sectionType">
            <h2>sectionType</h2>
            <hr />
            
            <pre><code>sectionType</code></pre>
         </article>
         
         <article class="global" data-name="sectionImport">
            <h2>sectionImport</h2>
            <hr />
            
            <pre><code>sectionImport</code></pre>
         </article>
         
         <article class="global" data-name="sectionFunction">
            <h2>sectionFunction</h2>
            <hr />
            
            <pre><code>sectionFunction</code></pre>
         </article>
         
         <article class="global" data-name="sectionTable">
            <h2>sectionTable</h2>
            <hr />
            
            <pre><code>sectionTable</code></pre>
         </article>
         
         <article class="global" data-name="sectionMemory">
            <h2>sectionMemory</h2>
            <hr />
            
            <pre><code>sectionMemory</code></pre>
         </article>
         
         <article class="global" data-name="sectionGlobal">
            <h2>sectionGlobal</h2>
            <hr />
            
            <pre><code>sectionGlobal</code></pre>
         </article>
         
         <article class="global" data-name="sectionExport">
            <h2>sectionExport</h2>
            <hr />
            
            <pre><code>sectionExport</code></pre>
         </article>
         
         <article class="global" data-name="sectionStart">
            <h2>sectionStart</h2>
            <hr />
            
            <pre><code>sectionStart</code></pre>
         </article>
         
         <article class="global" data-name="sectionElement">
            <h2>sectionElement</h2>
            <hr />
            
            <pre><code>sectionElement</code></pre>
         </article>
         
         <article class="global" data-name="sectionCode">
            <h2>sectionCode</h2>
            <hr />
            
            <pre><code>sectionCode</code></pre>
         </article>
         
         <article class="global" data-name="sectionData">
            <h2>sectionData</h2>
            <hr />
            
            <pre><code>sectionData</code></pre>
         </article>
         
         <article class="global" data-name="funcValueOffset">
            <h2>funcValueOffset</h2>
            <hr />
            
            <p>funcValueOffset is the offset between the PC_F value of a function and the index of the function in WebAssembly</p>
            
            <pre><code>funcValueOffset</code></pre>
         </article>
         
         <article class="global" data-name="wasmFuncTypes">
            <h2>wasmFuncTypes</h2>
            <hr />
            
            <pre><code>wasmFuncTypes</code></pre>
         </article>
         
         <article class="global" data-name="dataSects">
            <h2>dataSects</h2>
            <hr />
            
            <pre><code>dataSects []wasmDataSect</code></pre>
         </article>
         
         <article class="global" data-name="nameRegexp">
            <h2>nameRegexp</h2>
            <hr />
            
            <pre><code>nameRegexp</code></pre>
         </article>
          
         <article class="struct" data-name="wasmFunc">
            <h2>type wasmFunc struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">Module string
Name string
Type uint32
Code []byte</code></pre>
         </article>
         
         <article class="struct" data-name="wasmFuncType">
            <h2>type wasmFuncType struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">Params []byte
Results []byte</code></pre>
         </article>
         
         <article class="struct" data-name="wasmDataSect">
            <h2>type wasmDataSect struct</h2>
            <hr />
            
            <pre
               class="fields-block"
            ><code class="fields-code">sect *sym.Section
data []byte</code></pre>
         </article>
          
         <article class="function" data-name="gentext">
            <h2>gentext</h2>
            <hr />
            
            <pre><code>func gentext(ctxt *ld.Link, ldr *loader.Loader)</code></pre>
         </article>
         
         <article class="function" data-name="readWasmImport">
            <h2>readWasmImport</h2>
            <hr />
            
            <pre><code>func readWasmImport(ldr *loader.Loader, s loader.Sym) obj.WasmImport</code></pre>
         </article>
         
         <article class="function" data-name="assignAddress">
            <h2>assignAddress</h2>
            <hr />
            
            <pre><code>func assignAddress(ldr *loader.Loader, sect *sym.Section, n int, s loader.Sym, va uint64, isTramp bool) (*sym.Section, int, uint64)</code></pre>
         </article>
         
         <article class="function" data-name="asmb">
            <h2>asmb</h2>
            <hr />
            
            <pre><code>func asmb(ctxt *ld.Link, ldr *loader.Loader)</code></pre>
         </article>
         
         <article class="function" data-name="asmb2">
            <h2>asmb2</h2>
            <hr />
            
            <p>asmb writes the final WebAssembly module binary.
Spec: https://webassembly.github.io/spec/core/binary/modules.html</p>
            
            <pre><code>func asmb2(ctxt *ld.Link, ldr *loader.Loader)</code></pre>
         </article>
         
         <article class="function" data-name="lookupType">
            <h2>lookupType</h2>
            <hr />
            
            <pre><code>func lookupType(sig *wasmFuncType, types *[]*wasmFuncType) uint32</code></pre>
         </article>
         
         <article class="function" data-name="writeSecHeader">
            <h2>writeSecHeader</h2>
            <hr />
            
            <pre><code>func writeSecHeader(ctxt *ld.Link, id uint8) int64</code></pre>
         </article>
         
         <article class="function" data-name="writeSecSize">
            <h2>writeSecSize</h2>
            <hr />
            
            <pre><code>func writeSecSize(ctxt *ld.Link, sizeOffset int64)</code></pre>
         </article>
         
         <article class="function" data-name="writeBuildID">
            <h2>writeBuildID</h2>
            <hr />
            
            <pre><code>func writeBuildID(ctxt *ld.Link, buildid []byte)</code></pre>
         </article>
         
         <article class="function" data-name="writeTypeSec">
            <h2>writeTypeSec</h2>
            <hr />
            
            <p>writeTypeSec writes the section that declares all function types
so they can be referenced by index.</p>
            
            <pre><code>func writeTypeSec(ctxt *ld.Link, types []*wasmFuncType)</code></pre>
         </article>
         
         <article class="function" data-name="writeImportSec">
            <h2>writeImportSec</h2>
            <hr />
            
            <p>writeImportSec writes the section that lists the functions that get
imported from the WebAssembly host, usually JavaScript.</p>
            
            <pre><code>func writeImportSec(ctxt *ld.Link, hostImports []*wasmFunc)</code></pre>
         </article>
         
         <article class="function" data-name="writeFunctionSec">
            <h2>writeFunctionSec</h2>
            <hr />
            
            <p>writeFunctionSec writes the section that declares the types of functions.
The bodies of these functions will later be provided in the "code" section.</p>
            
            <pre><code>func writeFunctionSec(ctxt *ld.Link, fns []*wasmFunc)</code></pre>
         </article>
         
         <article class="function" data-name="writeTableSec">
            <h2>writeTableSec</h2>
            <hr />
            
            <p>writeTableSec writes the section that declares tables. Currently there is only a single table
that is used by the CallIndirect operation to dynamically call any function.
The contents of the table get initialized by the "element" section.</p>
            
            <pre><code>func writeTableSec(ctxt *ld.Link, fns []*wasmFunc)</code></pre>
         </article>
         
         <article class="function" data-name="writeMemorySec">
            <h2>writeMemorySec</h2>
            <hr />
            
            <p>writeMemorySec writes the section that declares linear memories. Currently one linear memory is being used.
Linear memory always starts at address zero. More memory can be requested with the GrowMemory instruction.</p>
            
            <pre><code>func writeMemorySec(ctxt *ld.Link, ldr *loader.Loader)</code></pre>
         </article>
         
         <article class="function" data-name="writeGlobalSec">
            <h2>writeGlobalSec</h2>
            <hr />
            
            <p>writeGlobalSec writes the section that declares global variables.</p>
            
            <pre><code>func writeGlobalSec(ctxt *ld.Link)</code></pre>
         </article>
         
         <article class="function" data-name="writeExportSec">
            <h2>writeExportSec</h2>
            <hr />
            
            <p>writeExportSec writes the section that declares exports.
Exports can be accessed by the WebAssembly host, usually JavaScript.
The wasm_export_* functions and the linear memory get exported.</p>
            
            <pre><code>func writeExportSec(ctxt *ld.Link, ldr *loader.Loader, lenHostImports int)</code></pre>
         </article>
         
         <article class="function" data-name="writeElementSec">
            <h2>writeElementSec</h2>
            <hr />
            
            <p>writeElementSec writes the section that initializes the tables declared by the "table" section.
The table for CallIndirect gets initialized in a very simple way so that each table index (PC_F value)
maps linearly to the function index (numImports + PC_F).</p>
            
            <pre><code>func writeElementSec(ctxt *ld.Link, numImports uint64, numFns uint64)</code></pre>
         </article>
         
         <article class="function" data-name="writeCodeSec">
            <h2>writeCodeSec</h2>
            <hr />
            
            <p>writeCodeSec writes the section that provides the function bodies for the functions
declared by the "func" section.</p>
            
            <pre><code>func writeCodeSec(ctxt *ld.Link, fns []*wasmFunc)</code></pre>
         </article>
         
         <article class="function" data-name="writeDataSec">
            <h2>writeDataSec</h2>
            <hr />
            
            <p>writeDataSec writes the section that provides data that will be used to initialize the linear memory.</p>
            
            <pre><code>func writeDataSec(ctxt *ld.Link)</code></pre>
         </article>
         
         <article class="function" data-name="writeProducerSec">
            <h2>writeProducerSec</h2>
            <hr />
            
            <p>writeProducerSec writes an optional section that reports the source language and compiler version.</p>
            
            <pre><code>func writeProducerSec(ctxt *ld.Link)</code></pre>
         </article>
         
         <article class="function" data-name="writeNameSec">
            <h2>writeNameSec</h2>
            <hr />
            
            <p>writeNameSec writes an optional section that assigns names to the functions declared by the "func" section.
The names are only used by WebAssembly stack traces, debuggers and decompilers.
TODO(neelance): add symbol table of DATA symbols</p>
            
            <pre><code>func writeNameSec(ctxt *ld.Link, firstFnIndex int, fns []*wasmFunc)</code></pre>
         </article>
         
         <article class="function" data-name="writeI32Const">
            <h2>writeI32Const</h2>
            <hr />
            
            <pre><code>func writeI32Const(w io.ByteWriter, v int32)</code></pre>
         </article>
         
         <article class="function" data-name="writeI64Const">
            <h2>writeI64Const</h2>
            <hr />
            
            <pre><code>func writeI64Const(w io.ByteWriter, v int64)</code></pre>
         </article>
         
         <article class="function" data-name="writeName">
            <h2>writeName</h2>
            <hr />
            
            <pre><code>func writeName(w nameWriter, name string)</code></pre>
         </article>
         
         <article class="function" data-name="writeUleb128">
            <h2>writeUleb128</h2>
            <hr />
            
            <pre><code>func writeUleb128(w io.ByteWriter, v uint64)</code></pre>
         </article>
         
         <article class="function" data-name="writeUleb128FixedLength">
            <h2>writeUleb128FixedLength</h2>
            <hr />
            
            <pre><code>func writeUleb128FixedLength(w io.ByteWriter, v uint64, length int)</code></pre>
         </article>
         
         <article class="function" data-name="writeSleb128">
            <h2>writeSleb128</h2>
            <hr />
            
            <pre><code>func writeSleb128(w io.ByteWriter, v int64)</code></pre>
         </article>
         
         <article class="function" data-name="fieldsToTypes">
            <h2>fieldsToTypes</h2>
            <hr />
            
            <pre><code>func fieldsToTypes(fields []obj.WasmField) []byte</code></pre>
         </article>
         
         <article class="function" data-name="Init">
            <h2>Init</h2>
            <hr />
            
            <pre><code>func Init() (*sys.Arch, ld.Arch)</code></pre>
         </article>
         
         <article class="function" data-name="archinit">
            <h2>archinit</h2>
            <hr />
            
            <pre><code>func archinit(ctxt *ld.Link)</code></pre>
         </article>
         
      </main>
      <script>
         function isPrivate(name) {
            return /^[a-z]/.test(name);
         }
         document.addEventListener("DOMContentLoaded", () => {
            const toggles = {
               functions: document.getElementById("showPrivateFunctions"),
               structs: document.getElementById("showPrivateStructs"),
               fields: document.getElementById("showPrivateFields"),
               globals: document.getElementById("showPrivateGlobals"),
            };
            const hideInitial = (selector, toggle) => {
               document.querySelectorAll(selector).forEach((el) => {
                  const name = el.dataset.name;
                  if (isPrivate(name)) {
                     el.classList.add("private", "hidden");
                  }
               });
               toggle.addEventListener("change", () => {
                  const show = toggle.checked;
                  document
                     .querySelectorAll(`${selector}.private`)
                     .forEach((el) => {
                        el.classList.toggle("hidden", !show);
                     });
               });
            };
            hideInitial("article.function", toggles.functions);
            hideInitial("article.struct", toggles.structs);
            hideInitial("article.global", toggles.globals);
            document
               .querySelectorAll("article.struct")
               .forEach((article) => {
                  const codeBlock =
                     article.querySelector("code.fields-code");
                  if (!codeBlock) return;
                  const lines = codeBlock.innerText.split("\n");
                  const newContent = lines
                     .map((line) => {
                        const trimmed = line.trim();
                        const nameMatch = trimmed.match(
                           /^([A-Za-z_][A-Za-z0-9_]*)/
                        );
                        if (!nameMatch)
                           return `<span class=\"field-line\">${line}</span>`;
                        const name = nameMatch[1];
                        const isPriv = isPrivate(name);
                        return `<span class=\"field-line${
                           isPriv ? " hidden private" : ""
                        }\" data-name=\"${name}\">${line}</span>`;
                     })
                     .join("");
                  codeBlock.innerHTML = newContent;
                  toggles.fields.addEventListener("change", () => {
                     const show = toggles.fields.checked;
                     article
                        .querySelectorAll(".field-line.private")
                        .forEach((el) =>
                           el.classList.toggle("hidden", !show)
                        );
                  });
               });
            const searchInput = document.getElementById("searchInput");
            searchInput.addEventListener("input", () => {
               const query = searchInput.value.trim().toLowerCase();
               document.querySelectorAll("article").forEach((el) => {
                  const name = el.dataset.name.toLowerCase();
                  if (query === "" || name.includes(query)) {
                     el.classList.remove("hidden");
                  } else {
                     el.classList.add("hidden");
                  }
               });
            });
         });
      </script>
   </body>
</html>
