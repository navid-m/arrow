<!DOCTYPE html>
<html lang="en" data-theme="dark">
   <head>
      <meta charset="UTF-8" />
      <meta
         name="viewport"
         content="width=device-width, initial-scale=1.0"
      />
      <title>Docs - devirtualize</title>
      <link
         href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"
         rel="stylesheet"
      />
      <style>
         html {
            font-size: 14px;
            scroll-behavior: smooth;
         }

         body {
            display: flex;
            min-height: 100vh;
            margin: 0;
            line-height: 1.6;
         }

         .sidebar {
            width: 12%;
            background: rgba(59, 56, 56, 0.15);
            padding: 1.5rem;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.4);
            overflow-y: auto;
            position: sticky;
            top: 0;
            height: 100vh;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
         }

         .sidebar::-webkit-scrollbar {
            width: 6px;
         }

         .sidebar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
         }

         .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
         }

         main {
            flex: 1;
            padding: 2rem;
            margin: 0;
            max-width: calc(100% - 280px);
            background: linear-gradient(
               135deg,
               rgba(59, 56, 56, 0.05) 0%,
               rgba(0, 0, 0, 0.1) 100%
            );
         }

         .nav-links {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
         }

         .nav-links a {
            color: #ddd;
            text-decoration: none;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s ease;
         }

         .nav-links a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
         }

         h1 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #fff 0%, #ddd 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
         }

         h2 {
            font-size: 1.4rem;
            margin: 1rem 0 0.5rem;
            color: #f0f0f0;
         }

         h3 {
            font-size: 1.2rem;
            margin: 0.8rem 0 0.3rem;
            color: #e0e0e0;
            position: relative;
         }

         .sidebar h2,
         .sidebar h3 {
            font-size: 1rem;
            margin: 0.5rem 0 0.3rem;
            color: #ccc;
         }

         /* Anchor link styling */
         .anchor {
            color: rgba(255, 255, 255, 0.3);
            text-decoration: none;
            font-weight: normal;
            margin-left: 0.5rem;
            opacity: 0;
            transition: opacity 0.2s ease;
            font-size: 0.8em;
         }

         h3:hover .anchor,
         .anchor:focus {
            opacity: 1;
         }

         .anchor:hover {
            color: rgba(255, 255, 255, 0.6);
         }

         /* Scroll target offset for fixed elements */
         .symbol-anchor {
            scroll-margin-top: 2rem;
         }

         pre {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e6e6e6;
            padding: 1rem 1.2rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.9rem;
            overflow-x: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
         }

         code {
            color: #f5f5f5;
            font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
            white-space: pre-wrap;
         }

         p {
            font-size: 15px;
            margin: 1rem 0;
            color: #ddd;
         }

         article {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(59, 56, 56, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
         }

         article:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
            transform: translateY(-2px);
         }

         article:target {
            border-color: rgba(100, 200, 255, 0.5);
            box-shadow: 0 0 0 2px rgba(100, 200, 255, 0.2);
         }

         .hidden {
            display: none !important;
         }

         .filter-section {
            margin-bottom: 1.5rem;
         }

         .filter-section h3 {
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #aaa;
         }

         .filter-toggle label {
            display: flex;
            align-items: center;
            margin-bottom: 0.6rem;
            font-size: 0.85rem;
            color: #bbb;
            cursor: pointer;
            padding: 0.3rem;
            border-radius: 4px;
            transition: background 0.2s ease;
         }

         .filter-toggle label:hover {
            background: rgba(255, 255, 255, 0.05);
         }

         .filter-toggle input {
            margin-right: 0.6rem;
         }

         .field-line,
         .method-line {
            display: block;
         }

         #searchInput {
            width: 100%;
            margin-bottom: 1.5rem;
            border-radius: 8px !important;
            height: 2.8rem;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 0 1rem;
         }

         #searchInput::placeholder {
            color: rgba(255, 255, 255, 0.5);
         }

         #searchInput:focus {
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
         }

         .section-divider {
            height: 1px;
            background: linear-gradient(
               90deg,
               transparent 0%,
               rgba(255, 255, 255, 0.3) 50%,
               transparent 100%
            );
            margin: 1.5rem 0;
         }

         .subpackage-list {
            list-style: none;
            padding: 0;
         }

         .subpackage-list li {
            margin-bottom: 0.4rem;
         }

         .subpackage-list a {
            display: block;
            padding: 0.5rem 0.8rem;
            color: #ccc;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 0.85rem;
         }

         .subpackage-list a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            transform: translateX(4px);
         }

         .empty-state {
            color: rgba(177, 175, 175, 0.6);
            font-style: italic;
            font-size: 0.8rem;
         }

         .badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            color: #ddd;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
            margin-left: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
         }

         .method-badge {
            background: rgba(100, 200, 255, 0.2);
            color: #87ceeb;
         }

         .const-badge {
            background: rgba(255, 200, 100, 0.2);
            color: #ffd700;
         }

         .var-badge {
            background: rgba(200, 255, 100, 0.2);
            color: #90ee90;
         }

         .type-badge {
            background: rgba(255, 100, 200, 0.2);
            color: #699eff;
         }

         .interface-badge {
            background: rgba(150, 100, 255, 0.2);
            color: #dda0dd;
         }

         .toc {
            position: sticky;
            top: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
         }

         .toc h4 {
            margin: 0 0 0.8rem;
            font-size: 0.9rem;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 0.5px;
         }

         .toc ul {
            list-style: none;
            padding: 0;
            margin: 0;
         }

         .toc li {
            margin-bottom: 0.3rem;
         }

         .toc a {
            color: #bbb;
            text-decoration: none;
            font-size: 0.8rem;
            transition: color 0.2s ease;
         }

         .toc a:hover {
            color: #fff;
         }

         .symbol-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.2);
         }

         .symbol-list::-webkit-scrollbar {
            width: 4px;
         }

         .symbol-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
         }

         .symbol-list ul {
            list-style: none;
            padding: 0.5rem;
            margin: 0;
         }

         .symbol-list li {
            margin-bottom: 0.2rem;
         }

         .symbol-list a {
            display: block;
            padding: 0.3rem 0.5rem;
            color: #bbb;
            text-decoration: none;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-size: 0.75rem;
         }

         .symbol-list a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
         }

         @media (max-width: 768px) {
            body {
               flex-direction: column;
            }

            .sidebar {
               width: 90%;
               height: auto;
               position: relative;
            }

            main {
               max-width: 100%;
               padding: 1rem;
            }
         }
      </style>
   </head>
   <body>
      <aside class="sidebar">
         <div class="nav-links">
            <a href="index.html" title="Home">⌂</a>
            <span>|</span>
            <a href="#" onclick="history.back()" title="Back">←</a>
         </div>

         <div class="filter-section">
            <h3>Search</h3>
            <input
               type="search"
               id="searchInput"
               placeholder="Search symbols..."
            />
         </div>

         <div class="filter-section">
            <h3>Filters</h3>
            <div class="filter-toggle">
               <label>
                  <input type="checkbox" id="showImports" />
                  Show imports
               </label>
               <label>
                  <input type="checkbox" id="showPrivateFunctions" />
                  Show private functions
               </label>
               <label>
                  <input type="checkbox" id="showPrivateStructs" />
                  Show private structs
               </label>
               <label>
                  <input type="checkbox" id="showPrivateFields" />
                  Show private fields
               </label>
               <label>
                  <input type="checkbox" id="showPrivateGlobals" />
                  Show private globals
               </label>
               <label>
                  <input type="checkbox" id="showPrivateTypes" />
                  Show private types
               </label>
               <label>
                  <input type="checkbox" id="showPrivateInterfaces" />
                  Show private interfaces
               </label>
            </div>
         </div>

         <div class="section-divider"></div>

         <div class="filter-section">
            <h3>Subpackages</h3>
            
            <div class="empty-state">No subpackages</div>
            
         </div>

         
         <div class="section-divider"></div>

         <div class="toc">
            <h4>Quick Navigation</h4>
            <ul>
                  
               <li><a href="#structs">Structs</a></li>
                
               <li><a href="#functions">Functions</a></li>
               
            </ul>
         </div>

         <div class="filter-section">
            <h3>All Symbols</h3>
            <div class="symbol-list">
               <ul id="symbolIndex">
               </ul>
            </div>
         </div>
         
      </aside>

      <main>
         <h1>devirtualize</h1>
         <div class="section-divider"></div>

         
         <section id="imports">
            <h2>Imports</h2>
            <article class="imports symbol-anchor" id="imports-section" data-name="imports">
               <h3>
                  Imports
                  <a href="#imports-section" class="anchor" title="Link to imports">#</a>
               </h3>
               <pre><code>"cmd/compile/internal/base"
"cmd/compile/internal/inline"
"cmd/compile/internal/ir"
"cmd/compile/internal/logopt"
"cmd/compile/internal/pgoir"
"cmd/compile/internal/typecheck"
"cmd/compile/internal/types"
"cmd/internal/obj"
"cmd/internal/src"
"encoding/json"
"fmt"
"os"
"strings"
"cmd/compile/internal/base"
"cmd/compile/internal/ir"
"cmd/compile/internal/typecheck"
"cmd/compile/internal/types"
</code></pre>
            </article>
         </section>
             
         <section id="structs">
            <h2>Structs</h2>
            
            <article class="struct symbol-anchor" id="CallStat" data-name="CallStat">
               <h3>
                  CallStat
                  <span class="badge">struct</span>
                  <a href="#CallStat" class="anchor" title="Link to CallStat">#</a>
               </h3>
               
               <p>CallStat summarizes a single call site.
This is used only for debug logging.</p>
               
               <pre
                  class="fields-block"
               ><code class="fields-code">type CallStat struct {
Pkg string
Pos string
Caller string
Direct bool
Interface bool
Weight int64
Hottest string
HottestWeight int64
Devirtualized string
DevirtualizedWeight int64
}</code></pre>
            </article>
            
         </section>
          
         <section id="functions">
            <h2>Functions</h2>
            
            <article class="function symbol-anchor" id="ProfileGuided" data-name="ProfileGuided">
               <h3>
                  ProfileGuided 
                  <span class="badge">function</span>
                  
                  <a href="#ProfileGuided" class="anchor" title="Link to ProfileGuided">#</a>
               </h3>
               
               <p>ProfileGuided performs call devirtualization of indirect calls based on
profile information.
Specifically, it performs conditional devirtualization of interface calls or
function value calls for the hottest callee.
That is, for interface calls it performs a transformation like:
type Iface interface {
Foo()
}
type Concrete struct{}
func (Concrete) Foo() {}
func foo(i Iface) {
i.Foo()
}
to:
func foo(i Iface) {
if c, ok := i.(Concrete); ok {
c.Foo()
} else {
i.Foo()
}
}
For function value calls it performs a transformation like:
func Concrete() {}
func foo(fn func()) {
fn()
}
to:
func foo(fn func()) {
if internal/abi.FuncPCABIInternal(fn) == internal/abi.FuncPCABIInternal(Concrete) {
Concrete()
} else {
fn()
}
}
The primary benefit of this transformation is enabling inlining of the
direct call.</p>
               
               <pre><code>func ProfileGuided(fn *ir.Func, p *pgoir.Profile)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="StaticCall" data-name="StaticCall">
               <h3>
                  StaticCall 
                  <span class="badge">function</span>
                  
                  <a href="#StaticCall" class="anchor" title="Link to StaticCall">#</a>
               </h3>
               
               <p>StaticCall devirtualizes the given call if possible when the concrete callee
is available statically.</p>
               
               <pre><code>func StaticCall(call *ir.CallExpr)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="condCall" data-name="condCall">
               <h3>
                  condCall 
                  <span class="badge">function</span>
                  
                  <a href="#condCall" class="anchor" title="Link to condCall">#</a>
               </h3>
               
               <p>condCall returns an ir.InlinedCallExpr that performs a call to thenCall if
cond is true and elseCall if cond is false. The return variables of the
InlinedCallExpr evaluate to the return values from the call.</p>
               
               <pre><code>func condCall(curfn *ir.Func, pos src.XPos, cond ir.Node, thenCall *ir.CallExpr, elseCall *ir.CallExpr, init ir.Nodes) *ir.InlinedCallExpr</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="constructCallStat" data-name="constructCallStat">
               <h3>
                  constructCallStat 
                  <span class="badge">function</span>
                  
                  <a href="#constructCallStat" class="anchor" title="Link to constructCallStat">#</a>
               </h3>
               
               <p>constructCallStat builds an initial CallStat describing this call, for
logging. If the call is devirtualized, the devirtualization fields should be
updated.</p>
               
               <pre><code>func constructCallStat(p *pgoir.Profile, fn *ir.Func, name string, call *ir.CallExpr) *CallStat</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="copyInputs" data-name="copyInputs">
               <h3>
                  copyInputs 
                  <span class="badge">function</span>
                  
                  <a href="#copyInputs" class="anchor" title="Link to copyInputs">#</a>
               </h3>
               
               <p>copyInputs copies the inputs to a call: the receiver (for interface calls)
or function value (for function value calls) and the arguments. These
expressions are evaluated once and assigned to temporaries.
The assignment statement is added to init and the copied receiver/fn
expression and copied arguments expressions are returned.</p>
               
               <pre><code>func copyInputs(curfn *ir.Func, pos src.XPos, recvOrFn ir.Node, args []ir.Node, init *ir.Nodes) (ir.Node, []ir.Node)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="findHotConcreteCallee" data-name="findHotConcreteCallee">
               <h3>
                  findHotConcreteCallee 
                  <span class="badge">function</span>
                  
                  <a href="#findHotConcreteCallee" class="anchor" title="Link to findHotConcreteCallee">#</a>
               </h3>
               
               <p>findHotConcreteCallee returns the *ir.Func of the hottest callee of a call,
if available, and its edge weight. extraFn can perform additional
applicability checks on each candidate edge. If extraFn returns false,
candidate will not be considered a valid callee candidate.</p>
               
               <pre><code>func findHotConcreteCallee(p *pgoir.Profile, caller *ir.Func, call *ir.CallExpr, extraFn func(callerName string, callOffset int, candidate *pgoir.IREdge) bool) (*ir.Func, int64)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="findHotConcreteFunctionCallee" data-name="findHotConcreteFunctionCallee">
               <h3>
                  findHotConcreteFunctionCallee 
                  <span class="badge">function</span>
                  
                  <a href="#findHotConcreteFunctionCallee" class="anchor" title="Link to findHotConcreteFunctionCallee">#</a>
               </h3>
               
               <p>findHotConcreteFunctionCallee returns the *ir.Func of the hottest callee of an
indirect function call, if available, and its edge weight.</p>
               
               <pre><code>func findHotConcreteFunctionCallee(p *pgoir.Profile, caller *ir.Func, call *ir.CallExpr) (*ir.Func, int64)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="findHotConcreteInterfaceCallee" data-name="findHotConcreteInterfaceCallee">
               <h3>
                  findHotConcreteInterfaceCallee 
                  <span class="badge">function</span>
                  
                  <a href="#findHotConcreteInterfaceCallee" class="anchor" title="Link to findHotConcreteInterfaceCallee">#</a>
               </h3>
               
               <p>findHotConcreteInterfaceCallee returns the *ir.Func of the hottest callee of an
interface call, if available, and its edge weight.</p>
               
               <pre><code>func findHotConcreteInterfaceCallee(p *pgoir.Profile, caller *ir.Func, call *ir.CallExpr) (*ir.Func, int64)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="interfaceCallRecvTypeAndMethod" data-name="interfaceCallRecvTypeAndMethod">
               <h3>
                  interfaceCallRecvTypeAndMethod 
                  <span class="badge">function</span>
                  
                  <a href="#interfaceCallRecvTypeAndMethod" class="anchor" title="Link to interfaceCallRecvTypeAndMethod">#</a>
               </h3>
               
               <p>interfaceCallRecvTypeAndMethod returns the type and the method of the interface
used in an interface call.</p>
               
               <pre><code>func interfaceCallRecvTypeAndMethod(call *ir.CallExpr) (*types.Type, *types.Sym)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="maybeDevirtualizeFunctionCall" data-name="maybeDevirtualizeFunctionCall">
               <h3>
                  maybeDevirtualizeFunctionCall 
                  <span class="badge">function</span>
                  
                  <a href="#maybeDevirtualizeFunctionCall" class="anchor" title="Link to maybeDevirtualizeFunctionCall">#</a>
               </h3>
               
               <p>Devirtualize an indirect function call if possible and eligible. Returns the new
ir.Node if call was devirtualized, and if so also the callee and weight of
the devirtualized edge.</p>
               
               <pre><code>func maybeDevirtualizeFunctionCall(p *pgoir.Profile, fn *ir.Func, call *ir.CallExpr) (ir.Node, *ir.Func, int64)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="maybeDevirtualizeInterfaceCall" data-name="maybeDevirtualizeInterfaceCall">
               <h3>
                  maybeDevirtualizeInterfaceCall 
                  <span class="badge">function</span>
                  
                  <a href="#maybeDevirtualizeInterfaceCall" class="anchor" title="Link to maybeDevirtualizeInterfaceCall">#</a>
               </h3>
               
               <p>Devirtualize interface call if possible and eligible. Returns the new
ir.Node if call was devirtualized, and if so also the callee and weight of
the devirtualized edge.</p>
               
               <pre><code>func maybeDevirtualizeInterfaceCall(p *pgoir.Profile, fn *ir.Func, call *ir.CallExpr) (ir.Node, *ir.Func, int64)</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="methodRecvType" data-name="methodRecvType">
               <h3>
                  methodRecvType 
                  <span class="badge">function</span>
                  
                  <a href="#methodRecvType" class="anchor" title="Link to methodRecvType">#</a>
               </h3>
               
               <p>methodRecvType returns the type containing method fn. Returns nil if fn
is not a method.</p>
               
               <pre><code>func methodRecvType(fn *ir.Func) *types.Type</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="retTemps" data-name="retTemps">
               <h3>
                  retTemps 
                  <span class="badge">function</span>
                  
                  <a href="#retTemps" class="anchor" title="Link to retTemps">#</a>
               </h3>
               
               <p>retTemps returns a slice of temporaries to be used for storing result values from call.</p>
               
               <pre><code>func retTemps(curfn *ir.Func, pos src.XPos, call *ir.CallExpr) []ir.Node</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="rewriteFunctionCall" data-name="rewriteFunctionCall">
               <h3>
                  rewriteFunctionCall 
                  <span class="badge">function</span>
                  
                  <a href="#rewriteFunctionCall" class="anchor" title="Link to rewriteFunctionCall">#</a>
               </h3>
               
               <p>rewriteFunctionCall devirtualizes the given OCALLFUNC using a direct
function call to callee.</p>
               
               <pre><code>func rewriteFunctionCall(call *ir.CallExpr, curfn *ir.Func, callee *ir.Func) ir.Node</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="rewriteInterfaceCall" data-name="rewriteInterfaceCall">
               <h3>
                  rewriteInterfaceCall 
                  <span class="badge">function</span>
                  
                  <a href="#rewriteInterfaceCall" class="anchor" title="Link to rewriteInterfaceCall">#</a>
               </h3>
               
               <p>rewriteInterfaceCall devirtualizes the given interface call using a direct
method call to concretetyp.</p>
               
               <pre><code>func rewriteInterfaceCall(call *ir.CallExpr, curfn *ir.Func, callee *ir.Func, concretetyp *types.Type) ir.Node</code></pre>
            </article>
            
            <article class="function symbol-anchor" id="shouldPGODevirt" data-name="shouldPGODevirt">
               <h3>
                  shouldPGODevirt 
                  <span class="badge">function</span>
                  
                  <a href="#shouldPGODevirt" class="anchor" title="Link to shouldPGODevirt">#</a>
               </h3>
               
               <p>shouldPGODevirt checks if we should perform PGO devirtualization to the
target function.
PGO devirtualization is most valuable when the callee is inlined, so if it
won't inline we can skip devirtualizing.</p>
               
               <pre><code>func shouldPGODevirt(fn *ir.Func) bool</code></pre>
            </article>
            
         </section>
         
      </main>

      <script>
         function isPrivate(name) {
            return /^[a-z]/.test(name);
         }

         function buildSymbolIndex() {
            const symbolIndex = document.getElementById('symbolIndex');
            if (!symbolIndex) return;

            const symbols = [];
            
            document.querySelectorAll('article[data-name]').forEach(article => {
               const name = article.dataset.name;
               const type = article.className.split(' ')[0]; 
               const isPrivateSymbol = isPrivate(name);
               
               if (name && name !== 'imports') {
                  symbols.push({
                     name,
                     type,
                     element: article,
                     isPrivate: isPrivateSymbol
                  });
               }
            });

            symbols.sort((a, b) => a.name.localeCompare(b.name));
            symbolIndex.innerHTML = '';
            symbols.forEach(symbol => {
               const li = document.createElement('li');
               const a = document.createElement('a');
               a.href = `#${symbol.name}`;
               a.textContent = symbol.name;
               a.title = `${symbol.type}: ${symbol.name}`;
               
               if (symbol.isPrivate) {
                  li.classList.add('private', 'hidden');
               }
               
               li.appendChild(a);
               symbolIndex.appendChild(li);
            });
         }

         document.addEventListener("DOMContentLoaded", () => {
            const toggles = {
               functions: document.getElementById("showPrivateFunctions"),
               imports: document.getElementById("showImports"),
               structs: document.getElementById("showPrivateStructs"),
               fields: document.getElementById("showPrivateFields"),
               globals: document.getElementById("showPrivateGlobals"),
               types: document.getElementById("showPrivateTypes"),
               interfaces: document.getElementById(
                  "showPrivateInterfaces"
               ),
            };

            const hideInitial = (selector, toggle) => {
               document.querySelectorAll(selector).forEach((el) => {
                  const name = el.dataset.name;
                  if (isPrivate(name)) {
                     el.classList.add("private", "hidden");
                  }
               });

               if (toggle) {
                  toggle.addEventListener("change", () => {
                     const show = toggle.checked;
                     document
                        .querySelectorAll(`${selector}.private`)
                        .forEach((el) => {
                           el.classList.toggle("hidden", !show);
                        });
                     
                     const symbolIndexItems = document.querySelectorAll('#symbolIndex li.private');
                     symbolIndexItems.forEach(li => {
                        const link = li.querySelector('a');
                        if (link) {
                           const targetId = link.getAttribute('href').substring(1);
                           const targetEl = document.getElementById(targetId);
                           if (targetEl && targetEl.matches(selector)) {
                              li.classList.toggle("hidden", !show);
                           }
                        }
                     });
                  });
               }
            };

            hideInitial("article.imports", toggles.imports);
            hideInitial("article.function", toggles.functions);
            hideInitial("article.struct", toggles.structs);
            hideInitial("article.global", toggles.globals);
            hideInitial("article.type", toggles.types);
            hideInitial("article.interface", toggles.interfaces);

            document
               .querySelectorAll("article.struct")
               .forEach((article) => {
                  const codeBlock =
                     article.querySelector("code.fields-code");
                  if (!codeBlock) return;

                  const lines = codeBlock.innerHTML.split("\n");
                  const newContent = lines
                     .map((line) => {
                        const trimmed = line.trim();
                        const nameMatch = trimmed.match(
                           /^([A-Za-z_][A-Za-z0-9_]*)/
                        );
                        if (!nameMatch && trimmed != "}") {
                           return `<span class="field-line">${line}</span>`;
                        }
                        if (nameMatch == null) return;
                        const name = nameMatch[1];
                        const isPriv = isPrivate(name);
                        return `<span class="field-line${
                           isPriv ? " hidden private" : ""
                        }" data-name="${name}">${line}</span>`;
                     })
                     .join("");

                  codeBlock.innerHTML = newContent;

                  if (toggles.fields) {
                     toggles.fields.addEventListener("change", () => {
                        const show = toggles.fields.checked;
                        article
                           .querySelectorAll(".field-line.private")
                           .forEach((el) =>
                              el.classList.toggle("hidden", !show)
                           );
                     });
                  }
               });

            document
               .querySelectorAll("article.interface")
               .forEach((article) => {
                  const codeBlock = article.querySelector(
                     "code.methods-code"
                  );
                  if (!codeBlock) return;

                  const lines = codeBlock.innerHTML.split("\n");
                  const newContent = lines
                     .map((line) => {
                        const trimmed = line.trim();
                        const nameMatch = trimmed.match(
                           /^([A-Za-z_][A-Za-z0-9_]*)/
                        );
                        if (!nameMatch) {
                           return `<span class="method-line">${line}</span>`;
                        }

                        const name = nameMatch[1];
                        const isPriv = isPrivate(name);
                        return `<span class="method-line${
                           isPriv ? " hidden private" : ""
                        }" data-name="${name}">${line}</span>`;
                     })
                     .join("");

                  codeBlock.innerHTML = newContent;

                  if (toggles.fields) {
                     toggles.fields.addEventListener("change", () => {
                        const show = toggles.fields.checked;
                        article
                           .querySelectorAll(".method-line.private")
                           .forEach((el) =>
                              el.classList.toggle("hidden", !show)
                           );
                     });
                  }
               });

            const searchInput = document.getElementById("searchInput");
            if (searchInput) {
               searchInput.addEventListener("input", () => {
                  const query = searchInput.value.trim().toLowerCase();

                  document.querySelectorAll("article").forEach((el) => {
                     const name = el.dataset.name;
                     if (!name) return;

                     const matches =
                        query === "" ||
                        name.toLowerCase().includes(query) ||
                        (el.textContent &&
                           el.textContent.toLowerCase().includes(query));

                     if (matches) {
                        const isPrivateEl =
                           el.classList.contains("private");
                        const shouldShowPrivate =
                           getPrivateToggleState(el);

                        if (!isPrivateEl || shouldShowPrivate) {
                           el.classList.remove("hidden");
                        }
                     } else {
                        el.classList.add("hidden");
                     }
                  });

                  document.querySelectorAll('#symbolIndex li').forEach(li => {
                     const link = li.querySelector('a');
                     if (link) {
                        const symbolName = link.textContent.toLowerCase();
                        const matches = query === "" || symbolName.includes(query);
                        
                        if (matches) {
                           const isPrivateSymbol = li.classList.contains('private');
                           const targetId = link.getAttribute('href').substring(1);
                           const targetEl = document.getElementById(targetId);
                           const shouldShowPrivate = targetEl ? getPrivateToggleState(targetEl) : false;
                           
                           if (!isPrivateSymbol || shouldShowPrivate) {
                              li.style.display = '';
                           }
                        } else {
                           li.style.display = 'none';
                        }
                     }
                  });
               });
            }

            function getPrivateToggleState(element) {
               if (element.classList.contains("function")) {
                  return toggles.functions?.checked || false;
               } else if (element.classList.contains("struct")) {
                  return toggles.structs?.checked || false;
               } else if (element.classList.contains("global")) {
                  return toggles.globals?.checked || false;
               } else if (element.classList.contains("type")) {
                  return toggles.types?.checked || false;
               } else if (element.classList.contains("interface")) {
                  return toggles.interfaces?.checked || false;
               } else if (element.classList.contains("imports")) {
                  return toggles.imports?.checked || false;
               }
               return false;
            }

            buildSymbolIndex();

            document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
               anchor.addEventListener("click", function (e) {
                  const target = document.querySelector(
                     this.getAttribute("href")
                  );
                  if (target) {
                     target.scrollIntoView({
                        behavior: "smooth",
                        block: "start",
                     });
                  }
               });
            });

            window.addEventListener('hashchange', () => {
               const hash = window.location.hash;
               if (hash) {
                  const target = document.querySelector(hash);
                  if (target) {
                     target.scrollIntoView({
                        behavior: "smooth",
                        block: "start",
                     });
                  }
               }
            });

            if (window.location.hash) {
               setTimeout(() => {
                  const target = document.querySelector(window.location.hash);
                  if (target) {
                     target.scrollIntoView({
                        behavior: "smooth",
                        block: "start",
                     });
                  }
               }, 100);
            }
         });
      </script>
   </body>
</html>